{
	"name": "Dev Fato Smart",
	"properties": {
		"activities": [
			{
				"name": "Fato Smart ITB",
				"type": "Copy",
				"dependsOn": [
					{
						"activity": "Fato Smart ITG",
						"dependencyConditions": [
							"Succeeded"
						]
					}
				],
				"policy": {
					"timeout": "7.00:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "SqlServerSource",
						"sqlReaderQuery": "with ctf as(\n\n    SELECT\n        x.ctf_cod    \n        ,x.ctf_tipo\n        ,case\n            when UPPER(x.ctf_categ) = 'C' then 'Consultas'\n            when UPPER(x.ctf_categ) = 'R' then 'Cirurgias'\n            when UPPER(x.ctf_categ) = 'E' then 'Exames'\n            when UPPER(x.ctf_categ) = 'T' then 'Taxas'\n            when UPPER(x.ctf_categ) = 'D' then 'Diárias'\n            when UPPER(x.ctf_categ) = 'A' then 'Terapia'\n            when UPPER(x.ctf_categ) = 'M' then 'Materiais'\n            when UPPER(x.ctf_categ) = 'S' then 'Materiais Especiais'\n            when UPPER(x.ctf_categ) = 'N' then 'Medicamentos'\n            when UPPER(x.ctf_categ) = 'G' then 'Gases'\n            when UPPER(x.ctf_categ) = 'O' then 'Outros'\n          end DS_CLASSIF_PROCEDIMENTO  \n    from  dbo.ctf x WITH (NOLOCK)\n)\n\n,aux_pre_fat as(\n\n    SELECT 'A' AS CD_TIPO_PFAT , 'ABERTO' AS DS_TIPO_PFAT\n        UNION ALL\n    SELECT 'P' AS CD_TIPO_PFAT , 'PROCESSADO' AS DS_TIPO_PFAT\n        UNION ALL\n    SELECT 'X' AS CD_TIPO_PFAT , 'EM PROCESSAMENTO' AS DS_TIPO_PFAT\n        UNION ALL\n    SELECT 'R' AS CD_TIPO_PFAT , 'PROCESSAMENTO INTERROPIDO POR ITENS SEM RATEIO' AS DS_TIPO_PFAT\n        UNION ALL                        \n    SELECT 'Z' AS CD_TIPO_PFAT , 'PRE-FATURA ZERADA' AS DS_TIPO_PFAT\n                       \n     \n)\n\n,aux_status_fat as(\n    SELECT 'A' AS CD_TIPO_FAT, 'ABERTO' AS DS_STATUS_FAT\n        UNION ALL\n    SELECT 'P' AS CD_TIPO_FAT, 'PENDENTE' AS DS_STATUS_FAT\n        UNION ALL\n    SELECT 'F' AS CD_TIPO_FAT, 'FATURADO' AS DS_STATUS_FAT\n        UNION ALL\n    SELECT 'C' AS CD_TIPO_FAT, 'CANCELADO' AS DS_STATUS_FAT\n    \n\n)\n\n\n\n,prod as(\nSELECT\n    pac.pac_nome\n    ,a.osm_pac                                                                              as cd_pessoa_fisica\n    ,cast(a.osm_num as varchar(15))                                                         as nr_atendimento\n    ,cast(a.osm_serie as varchar(15))                                                       as nr_interno_conta\n    ,cast(a.osm_serie as varchar(5)) +  cast(a.osm_num as varchar(15))                      as fk_num_os\n    ,a.osm_ctle_cnv                                                                         as nr_guia\n    ,a.osm_serie\n    ,a.osm_num\n    ,a.osm_dthr                                                                             as dt_entrada\n    ,a.osm_mreq                                                                             as cd_medico_sol\n    ,a.osm_atend                                                                            as cd_tipo_atend\n    ,a.osm_mcnv                                                                             as cd_carterinha_pac\n    ,a.osm_w_senha                                                                          as senha_conv\n    ,a.osm_cid_cod                                                                          as cd_cid\n    ,a.osm_pln_cod                                                                          as cd_plano_convenio\n    ,a.osm_leg_cod                                                                          as cd_estabelecimento\n    ,a.osm_cnv                                                                              as cd_convenio\n    ,a.osm_str                                                                              as cd_setor_atendimento\n    ,itm.smm_str                                                                            as cd_setor_executante\n    ,itm.smm_dthr_lanc                                                                      as dt_lanc_item\n    -- ,itm.smm_dthr_exec                                                                      as dt_lanc_item\n    ,itm.smm_med                                                                            as cd_medico_executante\n    ,itm.smm_pre_ccv                                                                        as cd_item_conv\n    ,smk.smk_cod                                                                            as cd_item_smart\n    -- ,ISNULL(dp.cod_thm_1992,dp.cod_thm_1990)                                                as cd_amb\n    ,smk.smk_amb                                                                             as cd_amb\n    ,smk.smk_ctf\n    ,smk.smk_tipo\n    ,smk.smk_nome                                                                           as ds_item\n    ,itm.smm_motivo_cancela                                                                 as motivo_cancel_item\n    ,itm.smm_canc_mot_cod                                                                   as cod_motivo_cancel_item\n    ,itm.smm_rpi_serie                                                                      as nr_serie_repasse\n    ,itm.smm_rpi_num                                                                        as nr_repasse\n    ,itm.smm_pacote                                                                         as ie_pacote\n    ,itm.smm_fat_serie\n    ,itm.smm_fat\n    ,itm.smm_tipo_fatura\n    ,itm.smm_sfat\n    ,itm.smm_mns_serie\n    ,itm.smm_mns_num                                                                      \n    ,itm.smm_qt                                                                             as qtd\n    ,itm.smm_vlr+ isnull(itm.smm_ajuste_vlr,0)                                              as vl_item\n    ,itm.smm_num\n    ,itm.smm_dthr_alter                                                                     as dt_atualizacao\nFROM dbo.osm a                WITH  (NOLOCK)\n-- left join dbo.hsp inter         (nolock) on inter.hsp_num = a.osm_hsp_num   \ninner join dbo.pac pac        WITH  (NOLOCK) on pac.pac_reg = a.osm_pac\ninner join dbo.smm itm        WITH  (NOLOCK) on itm.smm_osm = a.osm_num and itm.smm_osm_serie = a.osm_serie\ninner join dbo.smk smk        WITH   (NOLOCK) on smk.smk_cod = itm.smm_cod and smk.smk_tipo = itm.smm_tpcod\n-- left join dbo.cbhpm5_lpm dp     (NOLOCK) on dp.cod_cbhpm5 = itm.smm_pre_ccv\nWHERE \n    --  a.osm_num = 107911\n    --  a.osm_num in (109642,108325,61936,107911,90371)\n    --    and a.osm_serie = 120\n    --    and itm.smm_vlr <> 0\n        (itm.smm_pacote IS NULL OR ( itm.smm_pacote = 'C' )) \n    -- and year(cast(itm.smm_dthr_lanc as date)) = 2019\n       and itm.smm_canc_mot_cod is null \n       and itm.smm_sfat <> 'C' \n       and itm.smm_exec <> 'C'\n       and itm.smm_str like '%'\n       and smk.smk_ctf LIKE '%'\n    \n)\n\nselect \n    -- convert(varchar(10),a.dt_lancamento,111)\n    91                                                                                       AS ID_SYS \n    ,CAST(CAST(a.osm_serie as varchar(10)) \n        + cast(a.osm_num as varchar(50)) \n        + CAST(a.smm_num AS VARCHAR(50))\n        + CAST(a.cd_pessoa_fisica as varchar(50))\n         AS DECIMAL)                                                                       as NR_SEQUENCIA\n    ,a.cd_pessoa_fisica\n    ,a.nr_atendimento\n    ,a.nr_interno_conta\n    ,a.fk_num_os\n    ,a.cd_carterinha_pac\n    ,RTRIM(LTRIM(replace(a.nr_guia,'\"','')))                                                as nr_guia\n    ,a.cd_cid\n    ,RTRIM(LTRIM(replace(a.senha_conv,'\"','')))                                             as senha_conv\n    ,emp.emp_cgc                                                                            as cgc_convenio\n    ,emp.emp_raz_soc                                                                        as nm_razao_social\n    ,emp.emp_nome_fantasia                                                                  as nm_nome_fantasia\n    ,a.cd_convenio                                                                          as cd_convenio  \n    ,conv.cnv_nome                                                                          as ds_convenio\n    ,a.dt_entrada\n    ,G.gcc_cod                                                                              AS cd_estabelecimento\n    ,G.gcc_descr                                                                            AS ds_estabelecimento\n    ,str_fat.str_cod                                                                        as cd_estab_fat\n    ,str_fat.str_nome                                                                       as ds_estab_fat\n    ,str.str_nome                                                                           as ds_setor_atendimento\n    ,str_exec.str_nome                                                                      as ds_setor_executante\n    ,a.dt_lanc_item\n    ,c.DS_CLASSIF_PROCEDIMENTO                                                              as classif_item\n    ,a.smm_num\n    ,a.cd_amb\n    ,a.cd_item_conv                                                                         as cd_item    \n    ,replace(a.ds_item,',','')                                                              as ds_item\n    ,a.qtd                                                                                  as qt_item\n    ,a.vl_item                                                                              as vl_item\n    ,fat.fat_dini                                                                           as dt_inicio_pre_fat\n    ,cast(fat.fat_serie as varchar(10)) + '-' + cast(fat.fat_num as varchar(15))            as pre_fatura\n    ,DS_TIPO_PFAT                                                                           as status_pre_fatura\n    ,DS_STATUS_FAT                                                                          as status_faturamento\n    ,nfs.nfs_numero                                                                         as nr_nfs\n    ,nfs.nfs_tipo + cast(nfs.nfs_serie as varchar(50)) + cast(nfs.nfs_numero as varchar(50))               as fk_nfs\n    ,nfs.nfs_dt_emis                                                                        as dt_emissao_nf\n    ,nfs.nfs_dt_vcto                                                                        as dt_nf_vcto\n    ,nfs.nfs_dt_envio                                                                       as dt_envio_nfs\n    ,pac.pac_nome\nfrom prod a\ninner join dbo.str str           WITH   (NOLOCK)        on str.str_cod = a.cd_setor_atendimento\ninner join dbo.str str_exec      WITH   (NOLOCK)        on str_exec.str_cod = a.cd_setor_executante\ninner join dbo.gcc g             WITH   (NOLOCK)        on g.gcc_str_cod = str.str_str_cod\ninner join dbo.cnv conv          WITH   (NOLOCK)        on conv.cnv_cod = a.cd_convenio\ninner join dbo.emp               WITH   (nolock)        on emp_cod = conv.cnv_emp_cod  \ninner join ctf   c                                      on ctf_cod = a.smk_ctf  and ctf_tipo = a.smk_tipo\nleft join dbo.fat fat            WITH   (NOLOCK)        on fat.fat_num = a.smm_fat and fat.fat_serie = a.smm_fat_serie and a.cd_convenio = fat.fat_cnv\nleft join aux_status_fat                                on CD_TIPO_FAT = a.smm_sfat\nleft join dbo.nfs nfs            WITH   (nolock)        on nfs.nfs_numero = fat.fat_nfs_numero and fat.fat_nfs_tipo = nfs.nfs_tipo and nfs.nfs_serie = fat_nfs_serie\nleft join dbo.nfl nfl            WITH   (NOLOCK)        ON nfs.nfs_nfl_serie = nfl.nfl_serie and nfs.nfs_nfl_num = nfl.nfl_num\nleft join aux_pre_fat                                   on CD_TIPO_PFAT = fat.fat_stat\nleft join dbo.str str_fat        WITH   (nolock)        on str_fat.str_cod = nfl.nfl_str_emissor\n-- left join dbo.gcc g_fat          WITH   (nolock)        on g_fat.gcc_str_cod = fat.fat_str_cod_sol\ninner join dbo.pac  pac          WITH   (nolock)        on pac.pac_reg = a.cd_pessoa_fisica\n\nwhere \ncast(a.dt_entrada as date) between '2015-01-01' and '2021-12-31'\n-- and nfs.nfs_numero = 999908808\n-- -- 999902524\n-- 999905327\n-- and a.fk_num_os = '119.140357'\nand c.DS_CLASSIF_PROCEDIMENTO is not null\n",
						"queryTimeout": "02:00:00",
						"partitionOption": "None"
					},
					"sink": {
						"type": "AzureSqlSink",
						"writeBehavior": "insert",
						"disableMetricsCollection": false
					},
					"enableStaging": false,
					"translator": {
						"type": "TabularTranslator",
						"mappings": [
							{
								"source": {
									"name": "NR_SEQUENCIA",
									"type": "Decimal",
									"physicalType": "decimal",
									"scale": 0,
									"precision": 18
								},
								"sink": {
									"name": "NR_SEQUENCIA",
									"type": "Decimal",
									"physicalType": "decimal",
									"scale": 0,
									"precision": 18
								}
							},
							{
								"source": {
									"name": "cd_pessoa_fisica",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "cd_pessoa_fisica",
									"type": "Int32",
									"physicalType": "int"
								}
							},
							{
								"source": {
									"name": "nr_atendimento",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "nr_atendimento",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "nr_interno_conta",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "nr_interno_conta",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "fk_num_os",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "fk_num_os",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "cd_carterinha_pac",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "cd_carterinha_pac",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "nr_guia",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "nr_guia",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "cd_cid",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "cd_cid",
									"type": "String",
									"physicalType": "char"
								}
							},
							{
								"source": {
									"name": "senha_conv",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "senha_conv",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "cgc_convenio",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "cgc_convenio",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "nm_razao_social",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "nm_razao_social",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "nm_nome_fantasia",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "nm_nome_fantasia",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "cd_convenio",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "cd_convenio",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "ds_convenio",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "ds_convenio",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "dt_entrada",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "dt_entrada",
									"type": "DateTime",
									"physicalType": "datetime"
								}
							},
							{
								"source": {
									"name": "cd_estabelecimento",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "cd_estabelecimento",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "ds_estabelecimento",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "ds_estabelecimento",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "cd_estab_fat",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "cd_estab_fat",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "ds_estab_fat",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "ds_estab_fat",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "ds_setor_atendimento",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "ds_setor_atendimento",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "ds_setor_executante",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "ds_setor_executante",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "dt_lanc_item",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "dt_lanc_item",
									"type": "DateTime",
									"physicalType": "datetime"
								}
							},
							{
								"source": {
									"name": "classif_item",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "classif_item",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "cd_amb",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "cd_amb",
									"type": "String",
									"physicalType": "char"
								}
							},
							{
								"source": {
									"name": "cd_item",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "cd_item",
									"type": "String",
									"physicalType": "char"
								}
							},
							{
								"source": {
									"name": "ds_item",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "ds_item",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "qt_item",
									"type": "Decimal",
									"physicalType": "decimal",
									"scale": 0,
									"precision": 4
								},
								"sink": {
									"name": "qt_item",
									"type": "Decimal",
									"physicalType": "decimal",
									"scale": 0,
									"precision": 4
								}
							},
							{
								"source": {
									"name": "vl_item",
									"type": "Double",
									"physicalType": "float"
								},
								"sink": {
									"name": "vl_item",
									"type": "Double",
									"physicalType": "float"
								}
							},
							{
								"source": {
									"name": "dt_inicio_pre_fat",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "dt_inicio_pre_fat",
									"type": "DateTime",
									"physicalType": "datetime"
								}
							},
							{
								"source": {
									"name": "pre_fatura",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "pre_fatura",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "status_pre_fatura",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "status_pre_fatura",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "status_faturamento",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "status_faturamento",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "nr_nfs",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "nr_nfs",
									"type": "Int32",
									"physicalType": "int"
								}
							},
							{
								"source": {
									"name": "fk_nfs",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "fk_nfs",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "dt_emissao_nf",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "dt_emissao_nf",
									"type": "DateTime",
									"physicalType": "datetime"
								}
							},
							{
								"source": {
									"name": "dt_nf_vcto",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "dt_nf_vcto",
									"type": "DateTime",
									"physicalType": "datetime"
								}
							},
							{
								"source": {
									"name": "dt_envio_nfs",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "dt_envio_nfs",
									"type": "DateTime",
									"physicalType": "datetime"
								}
							},
							{
								"source": {
									"name": "pac_nome",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "pac_nome",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "smm_num",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "SMM_NUM",
									"type": "Int32",
									"physicalType": "int"
								}
							},
							{
								"source": {
									"name": "ID_SYS",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "ID_SYS",
									"type": "Int32",
									"physicalType": "int"
								}
							}
						],
						"typeConversion": true,
						"typeConversionSettings": {
							"allowDataTruncation": true,
							"treatBooleanAsNumber": false
						}
					}
				},
				"inputs": [
					{
						"referenceName": "SMART_ITABUNA_PrdDataSet",
						"type": "DatasetReference"
					}
				],
				"outputs": [
					{
						"referenceName": "AZ_FATO_CICLO_REC_SMART",
						"type": "DatasetReference"
					}
				]
			},
			{
				"name": "Fato Smart IOF",
				"type": "Copy",
				"dependsOn": [
					{
						"activity": "Fato Smart ITB",
						"dependencyConditions": [
							"Succeeded"
						]
					}
				],
				"policy": {
					"timeout": "7.00:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "SqlServerSource",
						"sqlReaderQuery": "with ctf as(\n\n    SELECT\n        x.ctf_cod    \n        ,x.ctf_tipo\n        ,case\n            when UPPER(x.ctf_categ) = 'C' then 'Consultas'\n            when UPPER(x.ctf_categ) = 'R' then 'Cirurgias'\n            when UPPER(x.ctf_categ) = 'E' then 'Exames'\n            when UPPER(x.ctf_categ) = 'T' then 'Taxas'\n            when UPPER(x.ctf_categ) = 'D' then 'Diárias'\n            when UPPER(x.ctf_categ) = 'A' then 'Terapia'\n            when UPPER(x.ctf_categ) = 'M' then 'Materiais'\n            when UPPER(x.ctf_categ) = 'S' then 'Materiais Especiais'\n            when UPPER(x.ctf_categ) = 'N' then 'Medicamentos'\n            when UPPER(x.ctf_categ) = 'G' then 'Gases'\n            when UPPER(x.ctf_categ) = 'O' then 'Outros'\n          end DS_CLASSIF_PROCEDIMENTO  \n    from  dbo.ctf x WITH (NOLOCK)\n)\n\n,aux_pre_fat as(\n\n    SELECT 'A' AS CD_TIPO_PFAT , 'ABERTO' AS DS_TIPO_PFAT\n        UNION ALL\n    SELECT 'P' AS CD_TIPO_PFAT , 'PROCESSADO' AS DS_TIPO_PFAT\n        UNION ALL\n    SELECT 'X' AS CD_TIPO_PFAT , 'EM PROCESSAMENTO' AS DS_TIPO_PFAT\n        UNION ALL\n    SELECT 'R' AS CD_TIPO_PFAT , 'PROCESSAMENTO INTERROPIDO POR ITENS SEM RATEIO' AS DS_TIPO_PFAT\n        UNION ALL                        \n    SELECT 'Z' AS CD_TIPO_PFAT , 'PRE-FATURA ZERADA' AS DS_TIPO_PFAT\n                       \n     \n)\n\n,aux_status_fat as(\n    SELECT 'A' AS CD_TIPO_FAT, 'ABERTO' AS DS_STATUS_FAT\n        UNION ALL\n    SELECT 'P' AS CD_TIPO_FAT, 'PENDENTE' AS DS_STATUS_FAT\n        UNION ALL\n    SELECT 'F' AS CD_TIPO_FAT, 'FATURADO' AS DS_STATUS_FAT\n        UNION ALL\n    SELECT 'C' AS CD_TIPO_FAT, 'CANCELADO' AS DS_STATUS_FAT\n    \n\n)\n\n\n\n,prod as(\nSELECT\n    pac.pac_nome\n    ,a.osm_pac                                                                              as cd_pessoa_fisica\n    ,cast(a.osm_num as varchar(15))                                                         as nr_atendimento\n    ,cast(a.osm_serie as varchar(15))                                                       as nr_interno_conta\n    ,cast(a.osm_serie as varchar(5)) +  cast(a.osm_num as varchar(15))                      as fk_num_os\n    ,a.osm_ctle_cnv                                                                         as nr_guia\n    ,a.osm_serie\n    ,a.osm_num\n    ,a.osm_dthr                                                                             as dt_entrada\n    ,a.osm_mreq                                                                             as cd_medico_sol\n    ,a.osm_atend                                                                            as cd_tipo_atend\n    ,a.osm_mcnv                                                                             as cd_carterinha_pac\n    ,a.osm_w_senha                                                                          as senha_conv\n    ,a.osm_cid_cod                                                                          as cd_cid\n    ,a.osm_pln_cod                                                                          as cd_plano_convenio\n    ,a.osm_leg_cod                                                                          as cd_estabelecimento\n    ,a.osm_cnv                                                                              as cd_convenio\n    ,a.osm_str                                                                              as cd_setor_atendimento\n    ,itm.smm_str                                                                            as cd_setor_executante\n    ,itm.smm_dthr_lanc                                                                      as dt_lanc_item\n    -- ,itm.smm_dthr_exec                                                                      as dt_lanc_item\n    ,itm.smm_med                                                                            as cd_medico_executante\n    ,itm.smm_pre_ccv                                                                        as cd_item_conv\n    ,smk.smk_cod                                                                            as cd_item_smart\n    -- ,ISNULL(dp.cod_thm_1992,dp.cod_thm_1990)                                                as cd_amb\n    ,smk.smk_amb                                                                             as cd_amb\n    ,smk.smk_ctf\n    ,smk.smk_tipo\n    ,smk.smk_nome                                                                           as ds_item\n    ,itm.smm_motivo_cancela                                                                 as motivo_cancel_item\n    ,itm.smm_canc_mot_cod                                                                   as cod_motivo_cancel_item\n    ,itm.smm_rpi_serie                                                                      as nr_serie_repasse\n    ,itm.smm_rpi_num                                                                        as nr_repasse\n    ,itm.smm_pacote                                                                         as ie_pacote\n    ,itm.smm_fat_serie\n    ,itm.smm_fat\n    ,itm.smm_tipo_fatura\n    ,itm.smm_sfat\n    ,itm.smm_mns_serie\n    ,itm.smm_mns_num                                                                      \n    ,itm.smm_qt                                                                             as qtd\n    ,itm.smm_vlr+ isnull(itm.smm_ajuste_vlr,0)                                              as vl_item\n    ,itm.smm_num\n    ,itm.smm_dthr_alter                                                                     as dt_atualizacao\nFROM dbo.osm a                WITH  (NOLOCK)\n-- left join dbo.hsp inter         (nolock) on inter.hsp_num = a.osm_hsp_num   \ninner join dbo.pac pac        WITH  (NOLOCK) on pac.pac_reg = a.osm_pac\ninner join dbo.smm itm        WITH  (NOLOCK) on itm.smm_osm = a.osm_num and itm.smm_osm_serie = a.osm_serie\ninner join dbo.smk smk        WITH   (NOLOCK) on smk.smk_cod = itm.smm_cod and smk.smk_tipo = itm.smm_tpcod\n-- left join dbo.cbhpm5_lpm dp     (NOLOCK) on dp.cod_cbhpm5 = itm.smm_pre_ccv\nWHERE \n    --  a.osm_num = 107911\n    --  a.osm_num in (109642,108325,61936,107911,90371)\n    --    and a.osm_serie = 120\n    --    and itm.smm_vlr <> 0\n        (itm.smm_pacote IS NULL OR ( itm.smm_pacote = 'C' )) \n    -- and year(cast(itm.smm_dthr_lanc as date)) = 2019\n       and itm.smm_canc_mot_cod is null \n       and itm.smm_sfat <> 'C' \n       and itm.smm_exec <> 'C'\n       and itm.smm_str like '%'\n       and smk.smk_ctf LIKE '%'\n    \n)\n\nselect \n    -- convert(varchar(10),a.dt_lancamento,111)\n    92                                                                                       AS ID_SYS \n    ,CAST(CAST(a.osm_serie as varchar(10)) \n        + cast(a.osm_num as varchar(50)) \n        + CAST(a.smm_num AS VARCHAR(50))\n        + CAST(a.cd_pessoa_fisica as varchar(50))\n         AS DECIMAL)                                                                       as NR_SEQUENCIA\n    ,a.cd_pessoa_fisica\n    ,a.nr_atendimento\n    ,a.nr_interno_conta\n    ,a.fk_num_os\n    ,a.cd_carterinha_pac\n    ,RTRIM(LTRIM(replace(a.nr_guia,'\"','')))                                                as nr_guia\n    ,a.cd_cid\n    ,RTRIM(LTRIM(replace(a.senha_conv,'\"','')))                                             as senha_conv\n    ,emp.emp_cgc                                                                            as cgc_convenio\n    ,emp.emp_raz_soc                                                                        as nm_razao_social\n    ,emp.emp_nome_fantasia                                                                  as nm_nome_fantasia\n    ,a.cd_convenio                                                                          as cd_convenio  \n    ,conv.cnv_nome                                                                          as ds_convenio\n    ,a.dt_entrada\n    ,G.gcc_cod                                                                              AS cd_estabelecimento\n    ,G.gcc_descr                                                                            AS ds_estabelecimento\n    ,str_fat.str_cod                                                                        as cd_estab_fat\n    ,str_fat.str_nome                                                                       as ds_estab_fat\n    ,str.str_nome                                                                           as ds_setor_atendimento\n    ,str_exec.str_nome                                                                      as ds_setor_executante\n    ,a.dt_lanc_item\n    ,c.DS_CLASSIF_PROCEDIMENTO                                                              as classif_item\n    ,a.smm_num\n    ,a.cd_amb\n    ,a.cd_item_conv                                                                         as cd_item    \n    ,replace(a.ds_item,',','')                                                              as ds_item\n    ,a.qtd                                                                                  as qt_item\n    ,a.vl_item                                                                              as vl_item\n    ,fat.fat_dini                                                                           as dt_inicio_pre_fat\n    ,cast(fat.fat_serie as varchar(10)) + '-' + cast(fat.fat_num as varchar(15))            as pre_fatura\n    ,DS_TIPO_PFAT                                                                           as status_pre_fatura\n    ,DS_STATUS_FAT                                                                          as status_faturamento\n    ,nfs.nfs_numero                                                                         as nr_nfs\n    ,nfs.nfs_tipo + cast(nfs.nfs_serie as varchar(50)) + cast(nfs.nfs_numero as varchar(50))               as fk_nfs\n    ,nfs.nfs_dt_emis                                                                        as dt_emissao_nf\n    ,nfs.nfs_dt_vcto                                                                        as dt_nf_vcto\n    ,nfs.nfs_dt_envio                                                                       as dt_envio_nfs\n    ,pac.pac_nome\nfrom prod a\ninner join dbo.str str           WITH   (NOLOCK)        on str.str_cod = a.cd_setor_atendimento\ninner join dbo.str str_exec      WITH   (NOLOCK)        on str_exec.str_cod = a.cd_setor_executante\ninner join dbo.gcc g             WITH   (NOLOCK)        on g.gcc_str_cod = str.str_str_cod\ninner join dbo.cnv conv          WITH   (NOLOCK)        on conv.cnv_cod = a.cd_convenio\ninner join dbo.emp               WITH   (nolock)        on emp_cod = conv.cnv_emp_cod  \ninner join ctf   c                                      on ctf_cod = a.smk_ctf  and ctf_tipo = a.smk_tipo\nleft join dbo.fat fat            WITH   (NOLOCK)        on fat.fat_num = a.smm_fat and fat.fat_serie = a.smm_fat_serie and a.cd_convenio = fat.fat_cnv\nleft join aux_status_fat                                on CD_TIPO_FAT = a.smm_sfat\nleft join dbo.nfs nfs            WITH   (nolock)        on nfs.nfs_numero = fat.fat_nfs_numero and fat.fat_nfs_tipo = nfs.nfs_tipo and nfs.nfs_serie = fat_nfs_serie\nleft join dbo.nfl nfl            WITH   (NOLOCK)        ON nfs.nfs_nfl_serie = nfl.nfl_serie and nfs.nfs_nfl_num = nfl.nfl_num\nleft join aux_pre_fat                                   on CD_TIPO_PFAT = fat.fat_stat\nleft join dbo.str str_fat        WITH   (nolock)        on str_fat.str_cod = nfl.nfl_str_emissor\n-- left join dbo.gcc g_fat          WITH   (nolock)        on g_fat.gcc_str_cod = fat.fat_str_cod_sol\ninner join dbo.pac  pac          WITH   (nolock)        on pac.pac_reg = a.cd_pessoa_fisica\n\nwhere \ncast(a.dt_entrada as date) between '2015-01-01' and '2021-12-31'\n-- and nfs.nfs_numero = 999908808\n-- -- 999902524\n-- 999905327\n-- and a.fk_num_os = '119.140357'\nand c.DS_CLASSIF_PROCEDIMENTO is not null\n",
						"queryTimeout": "02:00:00",
						"partitionOption": "None"
					},
					"sink": {
						"type": "AzureSqlSink",
						"writeBehavior": "insert",
						"disableMetricsCollection": false
					},
					"enableStaging": false,
					"translator": {
						"type": "TabularTranslator",
						"mappings": [
							{
								"source": {
									"name": "NR_SEQUENCIA",
									"type": "Decimal",
									"physicalType": "decimal",
									"scale": 0,
									"precision": 18
								},
								"sink": {
									"name": "NR_SEQUENCIA",
									"type": "Decimal",
									"physicalType": "decimal",
									"scale": 0,
									"precision": 18
								}
							},
							{
								"source": {
									"name": "cd_pessoa_fisica",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "cd_pessoa_fisica",
									"type": "Int32",
									"physicalType": "int"
								}
							},
							{
								"source": {
									"name": "nr_atendimento",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "nr_atendimento",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "nr_interno_conta",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "nr_interno_conta",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "fk_num_os",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "fk_num_os",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "cd_carterinha_pac",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "cd_carterinha_pac",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "nr_guia",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "nr_guia",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "cd_cid",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "cd_cid",
									"type": "String",
									"physicalType": "char"
								}
							},
							{
								"source": {
									"name": "senha_conv",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "senha_conv",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "cgc_convenio",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "cgc_convenio",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "nm_razao_social",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "nm_razao_social",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "nm_nome_fantasia",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "nm_nome_fantasia",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "cd_convenio",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "cd_convenio",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "ds_convenio",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "ds_convenio",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "dt_entrada",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "dt_entrada",
									"type": "DateTime",
									"physicalType": "datetime"
								}
							},
							{
								"source": {
									"name": "cd_estabelecimento",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "cd_estabelecimento",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "ds_estabelecimento",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "ds_estabelecimento",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "cd_estab_fat",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "cd_estab_fat",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "ds_estab_fat",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "ds_estab_fat",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "ds_setor_atendimento",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "ds_setor_atendimento",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "ds_setor_executante",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "ds_setor_executante",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "dt_lanc_item",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "dt_lanc_item",
									"type": "DateTime",
									"physicalType": "datetime"
								}
							},
							{
								"source": {
									"name": "classif_item",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "classif_item",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "cd_amb",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "cd_amb",
									"type": "String",
									"physicalType": "char"
								}
							},
							{
								"source": {
									"name": "cd_item",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "cd_item",
									"type": "String",
									"physicalType": "char"
								}
							},
							{
								"source": {
									"name": "ds_item",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "ds_item",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "qt_item",
									"type": "Decimal",
									"physicalType": "decimal",
									"scale": 0,
									"precision": 4
								},
								"sink": {
									"name": "qt_item",
									"type": "Decimal",
									"physicalType": "decimal",
									"scale": 0,
									"precision": 4
								}
							},
							{
								"source": {
									"name": "vl_item",
									"type": "Double",
									"physicalType": "float"
								},
								"sink": {
									"name": "vl_item",
									"type": "Double",
									"physicalType": "float"
								}
							},
							{
								"source": {
									"name": "dt_inicio_pre_fat",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "dt_inicio_pre_fat",
									"type": "DateTime",
									"physicalType": "datetime"
								}
							},
							{
								"source": {
									"name": "pre_fatura",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "pre_fatura",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "status_pre_fatura",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "status_pre_fatura",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "status_faturamento",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "status_faturamento",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "nr_nfs",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "nr_nfs",
									"type": "Int32",
									"physicalType": "int"
								}
							},
							{
								"source": {
									"name": "fk_nfs",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "fk_nfs",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "dt_emissao_nf",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "dt_emissao_nf",
									"type": "DateTime",
									"physicalType": "datetime"
								}
							},
							{
								"source": {
									"name": "dt_nf_vcto",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "dt_nf_vcto",
									"type": "DateTime",
									"physicalType": "datetime"
								}
							},
							{
								"source": {
									"name": "dt_envio_nfs",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "dt_envio_nfs",
									"type": "DateTime",
									"physicalType": "datetime"
								}
							},
							{
								"source": {
									"name": "pac_nome",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "pac_nome",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "smm_num",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "SMM_NUM",
									"type": "Int32",
									"physicalType": "int"
								}
							},
							{
								"source": {
									"name": "ID_SYS",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "ID_SYS",
									"type": "Int32",
									"physicalType": "int"
								}
							}
						],
						"typeConversion": true,
						"typeConversionSettings": {
							"allowDataTruncation": true,
							"treatBooleanAsNumber": false
						}
					}
				},
				"inputs": [
					{
						"referenceName": "SMART_IOF_PrdDataSet",
						"type": "DatasetReference"
					}
				],
				"outputs": [
					{
						"referenceName": "AZ_FATO_CICLO_REC_SMART",
						"type": "DatasetReference"
					}
				]
			},
			{
				"name": "Fato Smart OFTALMOCLIN",
				"type": "Copy",
				"dependsOn": [
					{
						"activity": "Fato Smart IOF",
						"dependencyConditions": [
							"Succeeded"
						]
					}
				],
				"policy": {
					"timeout": "7.00:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "SqlServerSource",
						"sqlReaderQuery": "with ctf as(\n\n    SELECT\n        x.ctf_cod    \n        ,x.ctf_tipo\n        ,case\n            when UPPER(x.ctf_categ) = 'C' then 'Consultas'\n            when UPPER(x.ctf_categ) = 'R' then 'Cirurgias'\n            when UPPER(x.ctf_categ) = 'E' then 'Exames'\n            when UPPER(x.ctf_categ) = 'T' then 'Taxas'\n            when UPPER(x.ctf_categ) = 'D' then 'Diárias'\n            when UPPER(x.ctf_categ) = 'A' then 'Terapia'\n            when UPPER(x.ctf_categ) = 'M' then 'Materiais'\n            when UPPER(x.ctf_categ) = 'S' then 'Materiais Especiais'\n            when UPPER(x.ctf_categ) = 'N' then 'Medicamentos'\n            when UPPER(x.ctf_categ) = 'G' then 'Gases'\n            when UPPER(x.ctf_categ) = 'O' then 'Outros'\n          end DS_CLASSIF_PROCEDIMENTO  \n    from  dbo.ctf x WITH (NOLOCK)\n)\n\n,aux_pre_fat as(\n\n    SELECT 'A' AS CD_TIPO_PFAT , 'ABERTO' AS DS_TIPO_PFAT\n        UNION ALL\n    SELECT 'P' AS CD_TIPO_PFAT , 'PROCESSADO' AS DS_TIPO_PFAT\n        UNION ALL\n    SELECT 'X' AS CD_TIPO_PFAT , 'EM PROCESSAMENTO' AS DS_TIPO_PFAT\n        UNION ALL\n    SELECT 'R' AS CD_TIPO_PFAT , 'PROCESSAMENTO INTERROPIDO POR ITENS SEM RATEIO' AS DS_TIPO_PFAT\n        UNION ALL                        \n    SELECT 'Z' AS CD_TIPO_PFAT , 'PRE-FATURA ZERADA' AS DS_TIPO_PFAT\n                       \n     \n)\n\n,aux_status_fat as(\n    SELECT 'A' AS CD_TIPO_FAT, 'ABERTO' AS DS_STATUS_FAT\n        UNION ALL\n    SELECT 'P' AS CD_TIPO_FAT, 'PENDENTE' AS DS_STATUS_FAT\n        UNION ALL\n    SELECT 'F' AS CD_TIPO_FAT, 'FATURADO' AS DS_STATUS_FAT\n        UNION ALL\n    SELECT 'C' AS CD_TIPO_FAT, 'CANCELADO' AS DS_STATUS_FAT\n    \n\n)\n\n\n\n,prod as(\nSELECT\n    pac.pac_nome\n    ,a.osm_pac                                                                              as cd_pessoa_fisica\n    ,cast(a.osm_num as varchar(15))                                                         as nr_atendimento\n    ,cast(a.osm_serie as varchar(15))                                                       as nr_interno_conta\n    ,cast(a.osm_serie as varchar(5)) +  cast(a.osm_num as varchar(15))                      as fk_num_os\n    ,a.osm_ctle_cnv                                                                         as nr_guia\n    ,a.osm_serie\n    ,a.osm_num\n    ,a.osm_dthr                                                                             as dt_entrada\n    ,a.osm_mreq                                                                             as cd_medico_sol\n    ,a.osm_atend                                                                            as cd_tipo_atend\n    ,a.osm_mcnv                                                                             as cd_carterinha_pac\n    ,a.osm_w_senha                                                                          as senha_conv\n    ,a.osm_cid_cod                                                                          as cd_cid\n    ,a.osm_pln_cod                                                                          as cd_plano_convenio\n    ,a.osm_leg_cod                                                                          as cd_estabelecimento\n    ,a.osm_cnv                                                                              as cd_convenio\n    ,a.osm_str                                                                              as cd_setor_atendimento\n    ,itm.smm_str                                                                            as cd_setor_executante\n    ,itm.smm_dthr_lanc                                                                      as dt_lanc_item\n    -- ,itm.smm_dthr_exec                                                                      as dt_lanc_item\n    ,itm.smm_med                                                                            as cd_medico_executante\n    ,itm.smm_pre_ccv                                                                        as cd_item_conv\n    ,smk.smk_cod                                                                            as cd_item_smart\n    -- ,ISNULL(dp.cod_thm_1992,dp.cod_thm_1990)                                                as cd_amb\n    ,smk.smk_amb                                                                             as cd_amb\n    ,smk.smk_ctf\n    ,smk.smk_tipo\n    ,smk.smk_nome                                                                           as ds_item\n    ,itm.smm_motivo_cancela                                                                 as motivo_cancel_item\n    ,itm.smm_canc_mot_cod                                                                   as cod_motivo_cancel_item\n    ,itm.smm_rpi_serie                                                                      as nr_serie_repasse\n    ,itm.smm_rpi_num                                                                        as nr_repasse\n    ,itm.smm_pacote                                                                         as ie_pacote\n    ,itm.smm_fat_serie\n    ,itm.smm_fat\n    ,itm.smm_tipo_fatura\n    ,itm.smm_sfat\n    ,itm.smm_mns_serie\n    ,itm.smm_mns_num                                                                      \n    ,itm.smm_qt                                                                             as qtd\n    ,itm.smm_vlr+ isnull(itm.smm_ajuste_vlr,0)                                              as vl_item\n    ,itm.smm_num\n    ,itm.smm_dthr_alter                                                                     as dt_atualizacao\nFROM dbo.osm a                WITH  (NOLOCK)\n-- left join dbo.hsp inter         (nolock) on inter.hsp_num = a.osm_hsp_num   \ninner join dbo.pac pac        WITH  (NOLOCK) on pac.pac_reg = a.osm_pac\ninner join dbo.smm itm        WITH  (NOLOCK) on itm.smm_osm = a.osm_num and itm.smm_osm_serie = a.osm_serie\ninner join dbo.smk smk        WITH   (NOLOCK) on smk.smk_cod = itm.smm_cod and smk.smk_tipo = itm.smm_tpcod\n-- left join dbo.cbhpm5_lpm dp     (NOLOCK) on dp.cod_cbhpm5 = itm.smm_pre_ccv\nWHERE \n    --  a.osm_num = 107911\n    --  a.osm_num in (109642,108325,61936,107911,90371)\n    --    and a.osm_serie = 120\n    --    and itm.smm_vlr <> 0\n        (itm.smm_pacote IS NULL OR ( itm.smm_pacote = 'C' )) \n    -- and year(cast(itm.smm_dthr_lanc as date)) = 2019\n       and itm.smm_canc_mot_cod is null \n       and itm.smm_sfat <> 'C' \n       and itm.smm_exec <> 'C'\n       and itm.smm_str like '%'\n       and smk.smk_ctf LIKE '%'\n    \n)\n\nselect \n    -- convert(varchar(10),a.dt_lancamento,111)\n    93                                                                                       AS ID_SYS \n    ,CAST(CAST(a.osm_serie as varchar(10)) \n        + cast(a.osm_num as varchar(50)) \n        + CAST(a.smm_num AS VARCHAR(50))\n        + CAST(a.cd_pessoa_fisica as varchar(50))\n         AS DECIMAL)                                                                       as NR_SEQUENCIA\n    ,a.cd_pessoa_fisica\n    ,a.nr_atendimento\n    ,a.nr_interno_conta\n    ,a.fk_num_os\n    ,a.cd_carterinha_pac\n    ,RTRIM(LTRIM(replace(a.nr_guia,'\"','')))                                                as nr_guia\n    ,a.cd_cid\n    ,RTRIM(LTRIM(replace(a.senha_conv,'\"','')))                                             as senha_conv\n    ,emp.emp_cgc                                                                            as cgc_convenio\n    ,emp.emp_raz_soc                                                                        as nm_razao_social\n    ,emp.emp_nome_fantasia                                                                  as nm_nome_fantasia\n    ,a.cd_convenio                                                                          as cd_convenio  \n    ,conv.cnv_nome                                                                          as ds_convenio\n    ,a.dt_entrada\n    ,G.gcc_cod                                                                              AS cd_estabelecimento\n    ,G.gcc_descr                                                                            AS ds_estabelecimento\n    ,str_fat.str_cod                                                                        as cd_estab_fat\n    ,str_fat.str_nome                                                                       as ds_estab_fat\n    ,str.str_nome                                                                           as ds_setor_atendimento\n    ,str_exec.str_nome                                                                      as ds_setor_executante\n    ,a.dt_lanc_item\n    ,c.DS_CLASSIF_PROCEDIMENTO                                                              as classif_item\n    ,a.smm_num\n    ,a.cd_amb\n    ,a.cd_item_conv                                                                         as cd_item    \n    ,replace(a.ds_item,',','')                                                              as ds_item\n    ,a.qtd                                                                                  as qt_item\n    ,a.vl_item                                                                              as vl_item\n    ,fat.fat_dini                                                                           as dt_inicio_pre_fat\n    ,cast(fat.fat_serie as varchar(10)) + '-' + cast(fat.fat_num as varchar(15))            as pre_fatura\n    ,DS_TIPO_PFAT                                                                           as status_pre_fatura\n    ,DS_STATUS_FAT                                                                          as status_faturamento\n    ,nfs.nfs_numero                                                                         as nr_nfs\n    ,nfs.nfs_tipo + cast(nfs.nfs_serie as varchar(50)) + cast(nfs.nfs_numero as varchar(50))               as fk_nfs\n    ,nfs.nfs_dt_emis                                                                        as dt_emissao_nf\n    ,nfs.nfs_dt_vcto                                                                        as dt_nf_vcto\n    ,nfs.nfs_dt_envio                                                                       as dt_envio_nfs\n    ,pac.pac_nome\nfrom prod a\ninner join dbo.str str           WITH   (NOLOCK)        on str.str_cod = a.cd_setor_atendimento\ninner join dbo.str str_exec      WITH   (NOLOCK)        on str_exec.str_cod = a.cd_setor_executante\ninner join dbo.gcc g             WITH   (NOLOCK)        on g.gcc_str_cod = str.str_str_cod\ninner join dbo.cnv conv          WITH   (NOLOCK)        on conv.cnv_cod = a.cd_convenio\ninner join dbo.emp               WITH   (nolock)        on emp_cod = conv.cnv_emp_cod  \ninner join ctf   c                                      on ctf_cod = a.smk_ctf  and ctf_tipo = a.smk_tipo\nleft join dbo.fat fat            WITH   (NOLOCK)        on fat.fat_num = a.smm_fat and fat.fat_serie = a.smm_fat_serie and a.cd_convenio = fat.fat_cnv\nleft join aux_status_fat                                on CD_TIPO_FAT = a.smm_sfat\nleft join dbo.nfs nfs            WITH   (nolock)        on nfs.nfs_numero = fat.fat_nfs_numero and fat.fat_nfs_tipo = nfs.nfs_tipo and nfs.nfs_serie = fat_nfs_serie\nleft join dbo.nfl nfl            WITH   (NOLOCK)        ON nfs.nfs_nfl_serie = nfl.nfl_serie and nfs.nfs_nfl_num = nfl.nfl_num\nleft join aux_pre_fat                                   on CD_TIPO_PFAT = fat.fat_stat\nleft join dbo.str str_fat        WITH   (nolock)        on str_fat.str_cod = nfl.nfl_str_emissor\n-- left join dbo.gcc g_fat          WITH   (nolock)        on g_fat.gcc_str_cod = fat.fat_str_cod_sol\ninner join dbo.pac  pac          WITH   (nolock)        on pac.pac_reg = a.cd_pessoa_fisica\n\nwhere \ncast(a.dt_entrada as date) between '2015-01-01' and '2021-12-31'\n-- and nfs.nfs_numero = 999908808\n-- -- 999902524\n-- 999905327\n-- and a.fk_num_os = '119.140357'\nand c.DS_CLASSIF_PROCEDIMENTO is not null\n",
						"queryTimeout": "02:00:00",
						"partitionOption": "None"
					},
					"sink": {
						"type": "AzureSqlSink",
						"writeBehavior": "insert",
						"disableMetricsCollection": false
					},
					"enableStaging": false,
					"translator": {
						"type": "TabularTranslator",
						"mappings": [
							{
								"source": {
									"name": "NR_SEQUENCIA",
									"type": "Decimal",
									"physicalType": "decimal",
									"scale": 0,
									"precision": 18
								},
								"sink": {
									"name": "NR_SEQUENCIA",
									"type": "Decimal",
									"physicalType": "decimal",
									"scale": 0,
									"precision": 18
								}
							},
							{
								"source": {
									"name": "cd_pessoa_fisica",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "cd_pessoa_fisica",
									"type": "Int32",
									"physicalType": "int"
								}
							},
							{
								"source": {
									"name": "nr_atendimento",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "nr_atendimento",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "nr_interno_conta",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "nr_interno_conta",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "fk_num_os",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "fk_num_os",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "cd_carterinha_pac",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "cd_carterinha_pac",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "nr_guia",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "nr_guia",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "cd_cid",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "cd_cid",
									"type": "String",
									"physicalType": "char"
								}
							},
							{
								"source": {
									"name": "senha_conv",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "senha_conv",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "cgc_convenio",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "cgc_convenio",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "nm_razao_social",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "nm_razao_social",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "nm_nome_fantasia",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "nm_nome_fantasia",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "cd_convenio",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "cd_convenio",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "ds_convenio",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "ds_convenio",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "dt_entrada",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "dt_entrada",
									"type": "DateTime",
									"physicalType": "datetime"
								}
							},
							{
								"source": {
									"name": "cd_estabelecimento",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "cd_estabelecimento",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "ds_estabelecimento",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "ds_estabelecimento",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "cd_estab_fat",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "cd_estab_fat",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "ds_estab_fat",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "ds_estab_fat",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "ds_setor_atendimento",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "ds_setor_atendimento",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "ds_setor_executante",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "ds_setor_executante",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "dt_lanc_item",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "dt_lanc_item",
									"type": "DateTime",
									"physicalType": "datetime"
								}
							},
							{
								"source": {
									"name": "classif_item",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "classif_item",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "cd_amb",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "cd_amb",
									"type": "String",
									"physicalType": "char"
								}
							},
							{
								"source": {
									"name": "cd_item",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "cd_item",
									"type": "String",
									"physicalType": "char"
								}
							},
							{
								"source": {
									"name": "ds_item",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "ds_item",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "qt_item",
									"type": "Decimal",
									"physicalType": "decimal",
									"scale": 0,
									"precision": 4
								},
								"sink": {
									"name": "qt_item",
									"type": "Decimal",
									"physicalType": "decimal",
									"scale": 0,
									"precision": 4
								}
							},
							{
								"source": {
									"name": "vl_item",
									"type": "Double",
									"physicalType": "float"
								},
								"sink": {
									"name": "vl_item",
									"type": "Double",
									"physicalType": "float"
								}
							},
							{
								"source": {
									"name": "dt_inicio_pre_fat",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "dt_inicio_pre_fat",
									"type": "DateTime",
									"physicalType": "datetime"
								}
							},
							{
								"source": {
									"name": "pre_fatura",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "pre_fatura",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "status_pre_fatura",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "status_pre_fatura",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "status_faturamento",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "status_faturamento",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "nr_nfs",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "nr_nfs",
									"type": "Int32",
									"physicalType": "int"
								}
							},
							{
								"source": {
									"name": "fk_nfs",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "fk_nfs",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "dt_emissao_nf",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "dt_emissao_nf",
									"type": "DateTime",
									"physicalType": "datetime"
								}
							},
							{
								"source": {
									"name": "dt_nf_vcto",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "dt_nf_vcto",
									"type": "DateTime",
									"physicalType": "datetime"
								}
							},
							{
								"source": {
									"name": "dt_envio_nfs",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "dt_envio_nfs",
									"type": "DateTime",
									"physicalType": "datetime"
								}
							},
							{
								"source": {
									"name": "pac_nome",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "pac_nome",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "smm_num",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "SMM_NUM",
									"type": "Int32",
									"physicalType": "int"
								}
							},
							{
								"source": {
									"name": "ID_SYS",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "ID_SYS",
									"type": "Int32",
									"physicalType": "int"
								}
							}
						],
						"typeConversion": true,
						"typeConversionSettings": {
							"allowDataTruncation": true,
							"treatBooleanAsNumber": false
						}
					}
				},
				"inputs": [
					{
						"referenceName": "SMART_Oftalmoclin_Prd_DataSet",
						"type": "DatasetReference"
					}
				],
				"outputs": [
					{
						"referenceName": "AZ_FATO_CICLO_REC_SMART",
						"type": "DatasetReference"
					}
				]
			},
			{
				"name": "Fato Smart ITG",
				"type": "Copy",
				"dependsOn": [],
				"policy": {
					"timeout": "7.00:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "SqlServerSource",
						"sqlReaderQuery": "with ctf as(\n\n    SELECT\n        x.ctf_cod    \n        ,x.ctf_tipo\n        ,case\n            when UPPER(x.ctf_categ) = 'C' then 'Consultas'\n            when UPPER(x.ctf_categ) = 'R' then 'Cirurgias'\n            when UPPER(x.ctf_categ) = 'E' then 'Exames'\n            when UPPER(x.ctf_categ) = 'T' then 'Taxas'\n            when UPPER(x.ctf_categ) = 'D' then 'Diárias'\n            when UPPER(x.ctf_categ) = 'A' then 'Terapia'\n            when UPPER(x.ctf_categ) = 'M' then 'Materiais'\n            when UPPER(x.ctf_categ) = 'S' then 'Materiais Especiais'\n            when UPPER(x.ctf_categ) = 'N' then 'Medicamentos'\n            when UPPER(x.ctf_categ) = 'G' then 'Gases'\n            when UPPER(x.ctf_categ) = 'O' then 'Outros'\n          end DS_CLASSIF_PROCEDIMENTO  \n    from  dbo.ctf x WITH (NOLOCK)\n)\n\n,aux_pre_fat as(\n\n    SELECT 'A' AS CD_TIPO_PFAT , 'ABERTO' AS DS_TIPO_PFAT\n        UNION ALL\n    SELECT 'P' AS CD_TIPO_PFAT , 'PROCESSADO' AS DS_TIPO_PFAT\n        UNION ALL\n    SELECT 'X' AS CD_TIPO_PFAT , 'EM PROCESSAMENTO' AS DS_TIPO_PFAT\n        UNION ALL\n    SELECT 'R' AS CD_TIPO_PFAT , 'PROCESSAMENTO INTERROPIDO POR ITENS SEM RATEIO' AS DS_TIPO_PFAT\n        UNION ALL                        \n    SELECT 'Z' AS CD_TIPO_PFAT , 'PRE-FATURA ZERADA' AS DS_TIPO_PFAT\n                       \n     \n)\n\n,aux_status_fat as(\n    SELECT 'A' AS CD_TIPO_FAT, 'ABERTO' AS DS_STATUS_FAT\n        UNION ALL\n    SELECT 'P' AS CD_TIPO_FAT, 'PENDENTE' AS DS_STATUS_FAT\n        UNION ALL\n    SELECT 'F' AS CD_TIPO_FAT, 'FATURADO' AS DS_STATUS_FAT\n        UNION ALL\n    SELECT 'C' AS CD_TIPO_FAT, 'CANCELADO' AS DS_STATUS_FAT\n    \n\n)\n\n\n\n,prod as(\nSELECT\n    pac.pac_nome\n    ,a.osm_pac                                                                              as cd_pessoa_fisica\n    ,cast(a.osm_num as varchar(15))                                                         as nr_atendimento\n    ,cast(a.osm_serie as varchar(15))                                                       as nr_interno_conta\n    ,cast(a.osm_serie as varchar(5)) +  cast(a.osm_num as varchar(15))                      as fk_num_os\n    ,a.osm_ctle_cnv                                                                         as nr_guia\n    ,a.osm_serie\n    ,a.osm_num\n    ,a.osm_dthr                                                                             as dt_entrada\n    ,a.osm_mreq                                                                             as cd_medico_sol\n    ,a.osm_atend                                                                            as cd_tipo_atend\n    ,a.osm_mcnv                                                                             as cd_carterinha_pac\n    ,a.osm_w_senha                                                                          as senha_conv\n    ,a.osm_cid_cod                                                                          as cd_cid\n    ,a.osm_pln_cod                                                                          as cd_plano_convenio\n    ,a.osm_leg_cod                                                                          as cd_estabelecimento\n    ,a.osm_cnv                                                                              as cd_convenio\n    ,a.osm_str                                                                              as cd_setor_atendimento\n    ,itm.smm_str                                                                            as cd_setor_executante\n    ,itm.smm_dthr_lanc                                                                      as dt_lanc_item\n    -- ,itm.smm_dthr_exec                                                                      as dt_lanc_item\n    ,itm.smm_med                                                                            as cd_medico_executante\n    ,itm.smm_pre_ccv                                                                        as cd_item_conv\n    ,smk.smk_cod                                                                            as cd_item_smart\n    -- ,ISNULL(dp.cod_thm_1992,dp.cod_thm_1990)                                                as cd_amb\n    ,smk.smk_amb                                                                             as cd_amb\n    ,smk.smk_ctf\n    ,smk.smk_tipo\n    ,smk.smk_nome                                                                           as ds_item\n    ,itm.smm_motivo_cancela                                                                 as motivo_cancel_item\n    ,itm.smm_canc_mot_cod                                                                   as cod_motivo_cancel_item\n    ,itm.smm_rpi_serie                                                                      as nr_serie_repasse\n    ,itm.smm_rpi_num                                                                        as nr_repasse\n    ,itm.smm_pacote                                                                         as ie_pacote\n    ,itm.smm_fat_serie\n    ,itm.smm_fat\n    ,itm.smm_tipo_fatura\n    ,itm.smm_sfat\n    ,itm.smm_mns_serie\n    ,itm.smm_mns_num                                                                      \n    ,itm.smm_qt                                                                             as qtd\n    ,itm.smm_vlr+ isnull(itm.smm_ajuste_vlr,0)                                              as vl_item\n    ,itm.smm_num\n    ,itm.smm_dthr_alter                                                                     as dt_atualizacao\nFROM dbo.osm a                WITH  (NOLOCK)\n-- left join dbo.hsp inter         (nolock) on inter.hsp_num = a.osm_hsp_num   \ninner join dbo.pac pac        WITH  (NOLOCK) on pac.pac_reg = a.osm_pac\ninner join dbo.smm itm        WITH  (NOLOCK) on itm.smm_osm = a.osm_num and itm.smm_osm_serie = a.osm_serie\ninner join dbo.smk smk        WITH   (NOLOCK) on smk.smk_cod = itm.smm_cod and smk.smk_tipo = itm.smm_tpcod\n-- left join dbo.cbhpm5_lpm dp     (NOLOCK) on dp.cod_cbhpm5 = itm.smm_pre_ccv\nWHERE \n    --  a.osm_num = 107911\n    --  a.osm_num in (109642,108325,61936,107911,90371)\n    --    and a.osm_serie = 120\n    --    and itm.smm_vlr <> 0\n        (itm.smm_pacote IS NULL OR ( itm.smm_pacote = 'C' )) \n    -- and year(cast(itm.smm_dthr_lanc as date)) = 2019\n       and itm.smm_canc_mot_cod is null \n       and itm.smm_sfat <> 'C' \n       and itm.smm_exec <> 'C'\n       and itm.smm_str like '%'\n       and smk.smk_ctf LIKE '%'\n    \n)\n\nselect \n    -- convert(varchar(10),a.dt_lancamento,111)\n    90                                                                                       AS ID_SYS \n    ,CAST(CAST(a.osm_serie as varchar(10)) \n        + cast(a.osm_num as varchar(50)) \n        + CAST(a.smm_num AS VARCHAR(50))\n        + CAST(a.cd_pessoa_fisica as varchar(50))\n         AS DECIMAL)                                                                       as NR_SEQUENCIA\n    ,a.cd_pessoa_fisica\n    ,a.nr_atendimento\n    ,a.nr_interno_conta\n    ,a.fk_num_os\n    ,a.cd_carterinha_pac\n    ,RTRIM(LTRIM(replace(a.nr_guia,'\"','')))                                                as nr_guia\n    ,a.cd_cid\n    ,RTRIM(LTRIM(replace(a.senha_conv,'\"','')))                                             as senha_conv\n    ,emp.emp_cgc                                                                            as cgc_convenio\n    ,emp.emp_raz_soc                                                                        as nm_razao_social\n    ,emp.emp_nome_fantasia                                                                  as nm_nome_fantasia\n    ,a.cd_convenio                                                                          as cd_convenio  \n    ,conv.cnv_nome                                                                          as ds_convenio\n    ,a.dt_entrada\n    ,G.gcc_cod                                                                              AS cd_estabelecimento\n    ,G.gcc_descr                                                                            AS ds_estabelecimento\n    ,str_fat.str_cod                                                                        as cd_estab_fat\n    ,str_fat.str_nome                                                                       as ds_estab_fat\n    ,str.str_nome                                                                           as ds_setor_atendimento\n    ,str_exec.str_nome                                                                      as ds_setor_executante\n    ,a.dt_lanc_item\n    ,c.DS_CLASSIF_PROCEDIMENTO                                                              as classif_item\n    ,a.smm_num\n    ,a.cd_amb\n    ,a.cd_item_conv                                                                         as cd_item    \n    ,replace(a.ds_item,',','')                                                              as ds_item\n    ,a.qtd                                                                                  as qt_item\n    ,a.vl_item                                                                              as vl_item\n    ,fat.fat_dini                                                                           as dt_inicio_pre_fat\n    ,cast(fat.fat_serie as varchar(10)) + '-' + cast(fat.fat_num as varchar(15))            as pre_fatura\n    ,DS_TIPO_PFAT                                                                           as status_pre_fatura\n    ,DS_STATUS_FAT                                                                          as status_faturamento\n    ,nfs.nfs_numero                                                                         as nr_nfs\n    ,nfs.nfs_tipo + cast(nfs.nfs_serie as varchar(50)) + cast(nfs.nfs_numero as varchar(50))               as fk_nfs\n    ,nfs.nfs_dt_emis                                                                        as dt_emissao_nf\n    ,nfs.nfs_dt_vcto                                                                        as dt_nf_vcto\n    ,nfs.nfs_dt_envio                                                                       as dt_envio_nfs\n    ,pac.pac_nome\nfrom prod a\ninner join dbo.str str           WITH   (NOLOCK)        on str.str_cod = a.cd_setor_atendimento\ninner join dbo.str str_exec      WITH   (NOLOCK)        on str_exec.str_cod = a.cd_setor_executante\ninner join dbo.gcc g             WITH   (NOLOCK)        on g.gcc_str_cod = str.str_str_cod\ninner join dbo.cnv conv          WITH   (NOLOCK)        on conv.cnv_cod = a.cd_convenio\ninner join dbo.emp               WITH   (nolock)        on emp_cod = conv.cnv_emp_cod  \ninner join ctf   c                                      on ctf_cod = a.smk_ctf  and ctf_tipo = a.smk_tipo\nleft join dbo.fat fat            WITH   (NOLOCK)        on fat.fat_num = a.smm_fat and fat.fat_serie = a.smm_fat_serie and a.cd_convenio = fat.fat_cnv\nleft join aux_status_fat                                on CD_TIPO_FAT = a.smm_sfat\nleft join dbo.nfs nfs            WITH   (nolock)        on nfs.nfs_numero = fat.fat_nfs_numero and fat.fat_nfs_tipo = nfs.nfs_tipo and nfs.nfs_serie = fat_nfs_serie\nleft join dbo.nfl nfl            WITH   (NOLOCK)        ON nfs.nfs_nfl_serie = nfl.nfl_serie and nfs.nfs_nfl_num = nfl.nfl_num\nleft join aux_pre_fat                                   on CD_TIPO_PFAT = fat.fat_stat\nleft join dbo.str str_fat        WITH   (nolock)        on str_fat.str_cod = nfl.nfl_str_emissor\n-- left join dbo.gcc g_fat          WITH   (nolock)        on g_fat.gcc_str_cod = fat.fat_str_cod_sol\ninner join dbo.pac  pac          WITH   (nolock)        on pac.pac_reg = a.cd_pessoa_fisica\n\nwhere \ncast(a.dt_entrada as date) between '2015-01-01' and '2021-12-31'\n-- and nfs.nfs_numero = 999908808\n-- -- 999902524\n-- 999905327\n-- and a.fk_num_os = '119.140357'\nand c.DS_CLASSIF_PROCEDIMENTO is not null\n",
						"queryTimeout": "02:00:00",
						"partitionOption": "None"
					},
					"sink": {
						"type": "AzureSqlSink",
						"preCopyScript": "TRUNCATE TABLE stg.aux_ciclo_rec_smart",
						"writeBehavior": "insert",
						"disableMetricsCollection": false
					},
					"enableStaging": false,
					"translator": {
						"type": "TabularTranslator",
						"mappings": [
							{
								"source": {
									"name": "NR_SEQUENCIA",
									"type": "Decimal",
									"physicalType": "decimal",
									"scale": 0,
									"precision": 18
								},
								"sink": {
									"name": "NR_SEQUENCIA",
									"type": "Decimal",
									"physicalType": "decimal",
									"scale": 0,
									"precision": 18
								}
							},
							{
								"source": {
									"name": "cd_pessoa_fisica",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "cd_pessoa_fisica",
									"type": "Int32",
									"physicalType": "int"
								}
							},
							{
								"source": {
									"name": "nr_atendimento",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "nr_atendimento",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "nr_interno_conta",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "nr_interno_conta",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "fk_num_os",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "fk_num_os",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "cd_carterinha_pac",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "cd_carterinha_pac",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "nr_guia",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "nr_guia",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "cd_cid",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "cd_cid",
									"type": "String",
									"physicalType": "char"
								}
							},
							{
								"source": {
									"name": "senha_conv",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "senha_conv",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "cgc_convenio",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "cgc_convenio",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "nm_razao_social",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "nm_razao_social",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "nm_nome_fantasia",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "nm_nome_fantasia",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "cd_convenio",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "cd_convenio",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "ds_convenio",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "ds_convenio",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "dt_entrada",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "dt_entrada",
									"type": "DateTime",
									"physicalType": "datetime"
								}
							},
							{
								"source": {
									"name": "cd_estabelecimento",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "cd_estabelecimento",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "ds_estabelecimento",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "ds_estabelecimento",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "cd_estab_fat",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "cd_estab_fat",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "ds_estab_fat",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "ds_estab_fat",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "ds_setor_atendimento",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "ds_setor_atendimento",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "ds_setor_executante",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "ds_setor_executante",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "dt_lanc_item",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "dt_lanc_item",
									"type": "DateTime",
									"physicalType": "datetime"
								}
							},
							{
								"source": {
									"name": "classif_item",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "classif_item",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "cd_amb",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "cd_amb",
									"type": "String",
									"physicalType": "char"
								}
							},
							{
								"source": {
									"name": "cd_item",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "cd_item",
									"type": "String",
									"physicalType": "char"
								}
							},
							{
								"source": {
									"name": "ds_item",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "ds_item",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "qt_item",
									"type": "Decimal",
									"physicalType": "decimal",
									"scale": 0,
									"precision": 4
								},
								"sink": {
									"name": "qt_item",
									"type": "Decimal",
									"physicalType": "decimal",
									"scale": 0,
									"precision": 4
								}
							},
							{
								"source": {
									"name": "vl_item",
									"type": "Double",
									"physicalType": "float"
								},
								"sink": {
									"name": "vl_item",
									"type": "Double",
									"physicalType": "float"
								}
							},
							{
								"source": {
									"name": "dt_inicio_pre_fat",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "dt_inicio_pre_fat",
									"type": "DateTime",
									"physicalType": "datetime"
								}
							},
							{
								"source": {
									"name": "pre_fatura",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "pre_fatura",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "status_pre_fatura",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "status_pre_fatura",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "status_faturamento",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "status_faturamento",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "nr_nfs",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "nr_nfs",
									"type": "Int32",
									"physicalType": "int"
								}
							},
							{
								"source": {
									"name": "fk_nfs",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "fk_nfs",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "dt_emissao_nf",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "dt_emissao_nf",
									"type": "DateTime",
									"physicalType": "datetime"
								}
							},
							{
								"source": {
									"name": "dt_nf_vcto",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "dt_nf_vcto",
									"type": "DateTime",
									"physicalType": "datetime"
								}
							},
							{
								"source": {
									"name": "dt_envio_nfs",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "dt_envio_nfs",
									"type": "DateTime",
									"physicalType": "datetime"
								}
							},
							{
								"source": {
									"name": "pac_nome",
									"type": "String",
									"physicalType": "char"
								},
								"sink": {
									"name": "pac_nome",
									"type": "String",
									"physicalType": "varchar"
								}
							},
							{
								"source": {
									"name": "smm_num",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "SMM_NUM",
									"type": "Int32",
									"physicalType": "int"
								}
							},
							{
								"source": {
									"name": "ID_SYS",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "ID_SYS",
									"type": "Int32",
									"physicalType": "int"
								}
							}
						],
						"typeConversion": true,
						"typeConversionSettings": {
							"allowDataTruncation": true,
							"treatBooleanAsNumber": false
						}
					}
				},
				"inputs": [
					{
						"referenceName": "SMART_ITAIGARA_PrdDataSet",
						"type": "DatasetReference"
					}
				],
				"outputs": [
					{
						"referenceName": "AZ_FATO_CICLO_REC_SMART",
						"type": "DatasetReference"
					}
				]
			}
		],
		"folder": {
			"name": "Ciclo Receita/Fato"
		},
		"annotations": []
	}
}