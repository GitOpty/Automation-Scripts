{
	"name": "NF Smart_TESTE_SELECT_DINAMICO",
	"properties": {
		"activities": [
			{
				"name": "Calendario",
				"type": "Lookup",
				"dependsOn": [
					{
						"activity": "DT_INICIO",
						"dependencyConditions": [
							"Succeeded"
						]
					},
					{
						"activity": "DT_FIM",
						"dependencyConditions": [
							"Succeeded"
						]
					}
				],
				"policy": {
					"timeout": "0.12:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "AzureSqlSource",
						"sqlReaderQuery": {
							"value": "@concat('\nSELECT DISTINCT\n    CAST(A.TheFirstOfMonth AS VARCHAR(20)) + '' 00:00:00.000'' AS DT_INICIO\n    ,CAST(A.TheLastOfMonth AS VARCHAR(20)) + '' 23:59:59.000'' AS DT_FIM\nFROM calendar A\nWHERE A.TheFirstOfMonth BETWEEN ','''',variables('DT_INICIO'),'''', ' AND  ','''',variables('DT_FIM'),'''')",
							"type": "Expression"
						},
						"queryTimeout": "02:00:00",
						"partitionOption": "None"
					},
					"dataset": {
						"referenceName": "SQL_DIN",
						"type": "DatasetReference"
					},
					"firstRowOnly": false
				}
			},
			{
				"name": "DT_INICIO",
				"type": "SetVariable",
				"dependsOn": [],
				"policy": {
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"variableName": "DT_INICIO",
					"value": "2021-01-01"
				}
			},
			{
				"name": "DT_FIM",
				"type": "SetVariable",
				"dependsOn": [],
				"policy": {
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"variableName": "DT_FIM",
					"value": "2021-09-01"
				}
			},
			{
				"name": "ForEach1",
				"type": "ForEach",
				"dependsOn": [
					{
						"activity": "Calendario",
						"dependencyConditions": [
							"Succeeded"
						]
					}
				],
				"userProperties": [],
				"typeProperties": {
					"items": {
						"value": "@activity('Calendario').output.value",
						"type": "Expression"
					},
					"isSequential": true,
					"activities": [
						{
							"name": "Stored procedure1",
							"type": "SqlServerStoredProcedure",
							"dependsOn": [],
							"policy": {
								"timeout": "0.12:00:00",
								"retry": 0,
								"retryIntervalInSeconds": 30,
								"secureOutput": false,
								"secureInput": false
							},
							"userProperties": [],
							"typeProperties": {
								"storedProcedureName": "[stg].[proc_debug]",
								"storedProcedureParameters": {
									"debug": {
										"value": {
											"value": "@concat(\n'DECLARE @DT_INICIO AS DATE\n DECLARE @DT_FIM     AS DATE\n\nSET @DT_INICIO = ','''', item().DT_INICIO,'''',\n'SET @DT_FIM = '  , '''', item().DT_FIM,'''',\n' SELECT \n 90 as estabelecimento  ',\n\n '\n     ,nfe_dt_emissao\n    , nfe_dt_entrada\n    , nfe_tipo\n    , nfe_serie\n    , nfe_num\n    , fne_cod\n    , fne_nome_fantasia\n    , ine_mat_cod\n    , mat_desc_resumida\n    , gmm_nome\n    , ine_qtde_entrada\n    , mat_unm_cod_entrada\n    , ine_vlr_unit_entrada\n    , nfe_ipg_aberto\n    , ine_vlr_desconto\n    , ine_vlr_ipi\n    , nfe_aft\n    , nfe_vlr_total\n    , ds_nfe_tipo\n    , nfe_crit_venc\n    , nfe_cpg_parcelas\n    , nfe_ipg_dt_vcto\n    , nfe_parcela_1\nFROM (\n    SELECT cfg.cfg_emp\n        , sba.sba_cod\n        , sba.sba_nome\n        , nfe.nfe_serie\n        , nfe.nfe_num\n        , nfe.nfe_fne_cod\n        , nfe.nfe_tipo\n        , CASE nfe.nfe_tipo\n\n                WHEN ''PR''\n                THEN ''Entrada''\n            WHEN ''SR''\n                THEN ''Simples Remessa''\n            WHEN ''SF''\n                THEN ''Simples Faturamento''\n            WHEN ''DV''\n                THEN ''Devolução''\n            WHEN ''TR''\n                THEN ''Transferência''\n            ELSE ''N/A''\n            END AS ds_nfe_tipo\n        , fne.fne_cod\n        , fne.fne_nome_fantasia\n        , nfe.nfe_vlr_total\n \n \n        , (\n            SELECT TOP 1 i.ipg_dt_vcto\n            FROM cpg c\n            INNER JOIN ipg i\n                ON (\n                        c.cpg_serie = i.ipg_cpg_serie\n                        AND c.cpg_num = i.ipg_cpg_num\n                        )\n            WHERE c.cpg_nfe_serie = nfe_serie\n                AND c.cpg_nfe_num = nfe_num\n                AND c.cpg_nfe_tipo = nfe_tipo\n                AND c.cpg_nfe_fne_cod = nfe_fne_cod\n            ORDER BY i.ipg_dt_vcto\n            ) AS nfe_ipg_dt_vcto\n        , (\n            SELECT count(ipg_parc)\n            FROM cpg c\n            INNER JOIN ipg i\n                ON (\n                        c.cpg_serie = i.ipg_cpg_serie\n                        AND c.cpg_num = i.ipg_cpg_num\n                        )\n            WHERE c.cpg_nfe_serie = nfe_serie\n                AND c.cpg_nfe_num = nfe_num\n                AND c.cpg_nfe_tipo = nfe_tipo\n                AND c.cpg_nfe_fne_cod = nfe_fne_cod\n            ) AS nfe_cpg_parcelas\n        , nfe.nfe_crit_venc\n        , nfe.nfe_parcela_1\n        , nfe.nfe_dt_emissao\n        , nfe.nfe_dt_entrada\n        , ine.ine_seq\n        , ine.ine_mat_cod\n        , mat.mat_desc_resumida\n        , mat.mat_lma_cod\n        , lma.lma_nome\n        , mat.mat_gmm_cod\n        , gmm.gmm_nome\n        , mat_unm_cod_entrada\n        , ine.ine_qtde AS ine_qtde_entrada\n        , ine.ine_vlr_unit AS ine_vlr_unit_entrada\n        , (\n            SELECT isnull(sum(ipg_valor), 0)\n            FROM cpg c\n            INNER JOIN ipg i\n                ON (\n                        c.cpg_serie = i.ipg_cpg_serie\n                        AND c.cpg_num = i.ipg_cpg_num\n                        )\n            WHERE c.cpg_nfe_serie = nfe_serie\n                AND c.cpg_nfe_num = nfe_num\n                AND c.cpg_nfe_tipo = nfe_tipo\n                AND c.cpg_nfe_fne_cod = nfe_fne_cod\n                AND i.ipg_status IN (''A'', ''R'')\n                AND i.ipg_dt_vcto <= @DT_FIM\n            ) AS nfe_ipg_aberto\n        , mat_unm_cod_saida\n        , '' AS solic\n        , '' AS DATA_solic\n        , convert(VARCHAR, ine_aft_serie) + ''.'' + convert(VARCHAR, ine_aft_num) AS nfe_aft\n        , aft_dthr\n        , ine.ine_qtde * mat_fat_conv_s_v AS ine_qtde_saida\n        , ine.ine_vlr_unit / mat_fat_conv_s_v AS ine_vlr_saida\n        , ine.ine_vlr_ipi\n        , ine.ine_vlr_desconto\n        , (\n            SELECT TOP 1 f.fne_cod\n            FROM nfe n WITH (NOLOCK)\n            INNER JOIN ine i WITH (NOLOCK)\n                ON (\n                        n.nfe_fne_cod = i.ine_fne_cod\n                        AND n.nfe_serie = i.ine_nfe_serie\n                        AND n.nfe_num = i.ine_nfe_num\n                        AND n.nfe_tipo = i.ine_nfe_tipo\n                          )\n            LEFT OUTER JOIN fne f WITH (NOLOCK)\n                ON ine.ine_fne_cod = fne.fne_cod\n            WHERE i.ine_mat_cod = ine.ine_mat_cod\n                AND f.fne_cod = ine.ine_fne_cod\n                AND (\n                    n.nfe_dt_entrada >= @DT_INICIO\n                    AND n.nfe_dt_entrada <= @DT_FIM\n                    )\n            ORDER BY n.nfe_dt_entrada DESC\n            ) AS ine_fne_cod\n        , (\n            SELECT TOP 1 f.fne_nome_fantasia\n            FROM nfe n WITH (NOLOCK)\n            INNER JOIN ine i WITH (NOLOCK)\n                ON (\n                        n.nfe_fne_cod = i.ine_fne_cod\n                        AND n.nfe_serie = i.ine_nfe_serie\n                        AND n.nfe_num = i.ine_nfe_num\n                        AND n.nfe_tipo = i.ine_nfe_tipo\n                        )\n            LEFT OUTER JOIN fne f WITH (NOLOCK)\n                ON ine.ine_fne_cod = fne.fne_cod\n            WHERE i.ine_mat_cod = ine.ine_mat_cod\n                AND f.fne_cod = ine.ine_fne_cod\n                AND (\n                   n.nfe_dt_entrada >= @DT_INICIO\n                 AND n.nfe_dt_entrada <= @DT_FIM\n                    )\n            ORDER BY n.nfe_dt_entrada DESC\n            ) AS ine_fne_nome_fantasia\n        , replace(replace(replace(emp_cgc, ''.'', ''''), ''/'', ''''), ''-'', '''') AS emp_cgc\n    FROM nfe WITH (NOLOCK)\n    INNER JOIN ine WITH (NOLOCK)\n        ON (\n                nfe.nfe_fne_cod = ine.ine_fne_cod\n                AND nfe.nfe_serie = ine.ine_nfe_serie\n                AND nfe.nfe_num = ine.ine_nfe_num\n                AND nfe.nfe_tipo = ine.ine_nfe_tipo\n                )\n    LEFT OUTER JOIN fne WITH (NOLOCK)\n        ON (convert(VARCHAR, ine.ine_fne_cod) = convert(VARCHAR, fne.fne_cod))\n    LEFT OUTER JOIN mat WITH (NOLOCK)\n        ON (mat.mat_cod = ine.ine_mat_cod)\n    LEFT OUTER JOIN lma WITH (NOLOCK)\n       ON (\n                lma.lma_cod = mat.mat_lma_cod\n                AND lma.lma_gmm_cod = mat.mat_gmm_cod\n                )\n    LEFT OUTER JOIN gmm WITH (NOLOCK)\n        ON (lma.lma_gmm_cod = gmm.gmm_cod)\n    LEFT OUTER JOIN sba WITH (NOLOCK)\n        ON (sba.sba_cod = nfe.nfe_sba_cod)\n    LEFT OUTER JOIN aft WITH (NOLOCK)\n        ON (\n               aft_serie = ine_aft_serie\n                AND aft_num = ine_aft_num\n                )\n    LEFT OUTER JOIN emp WITH (NOLOCK)\n        ON (emp.emp_fne_cod = fne.FNE_COD)\n    CROSS JOIN cfg\n    WHERE (\n            nfe.nfe_dt_entrada >= @DT_INICIO\n            AND nfe.nfe_dt_entrada <= @DT_FIM\n            )\n        AND (\n            fne.fne_cod IN (''%'')\n            OR (''%'' IN (''%''))\n            )\n    ) AS t1\nORDER BY sba_cod\n    , sba_nome\n    , nfe_tipo\n    , nfe_dt_entrada\n    , nfe_serie\n    , nfe_num\n    , ine_seq\n '\n\n)\n",
											"type": "Expression"
										},
										"type": "String"
									}
								}
							},
							"linkedServiceName": {
								"referenceName": "AzureSQL_DB_Procedimentos",
								"type": "LinkedServiceReference"
							}
						},
						{
							"name": "NF ITG",
							"type": "Copy",
							"dependsOn": [
								{
									"activity": "Stored procedure1",
									"dependencyConditions": [
										"Succeeded"
									]
								}
							],
							"policy": {
								"timeout": "7.00:00:00",
								"retry": 0,
								"retryIntervalInSeconds": 30,
								"secureOutput": false,
								"secureInput": false
							},
							"userProperties": [],
							"typeProperties": {
								"source": {
									"type": "SqlServerSource",
									"sqlReaderQuery": {
										"value": "@concat(\n'DECLARE @DT_INICIO AS DATE\n DECLARE @DT_FIM     AS DATE\n\nSET @DT_INICIO = ','''', item().DT_INICIO,'''',\n'SET @DT_FIM = '  , '''', item().DT_FIM,'''',\n' SELECT \n 90 as estabelecimento  ',\n\n '\n     ,nfe_dt_emissao\n    , nfe_dt_entrada\n    , nfe_tipo\n    , nfe_serie\n    , nfe_num\n    , fne_cod\n    , fne_nome_fantasia\n    , ine_mat_cod\n    , mat_desc_resumida\n    , gmm_nome\n    , ine_qtde_entrada\n    , mat_unm_cod_entrada\n    , ine_vlr_unit_entrada\n    , nfe_ipg_aberto\n    , ine_vlr_desconto\n    , ine_vlr_ipi\n    , nfe_aft\n    , nfe_vlr_total\n    , ds_nfe_tipo\n    , nfe_crit_venc\n    , nfe_cpg_parcelas\n    , nfe_ipg_dt_vcto\n    , nfe_parcela_1\nFROM (\n    SELECT cfg.cfg_emp\n        , sba.sba_cod\n        , sba.sba_nome\n        , nfe.nfe_serie\n        , nfe.nfe_num\n        , nfe.nfe_fne_cod\n        , nfe.nfe_tipo\n        , CASE nfe.nfe_tipo\n\n                WHEN ''PR''\n                THEN ''Entrada''\n            WHEN ''SR''\n                THEN ''Simples Remessa''\n            WHEN ''SF''\n                THEN ''Simples Faturamento''\n            WHEN ''DV''\n                THEN ''Devolução''\n            WHEN ''TR''\n                THEN ''Transferência''\n            ELSE ''N/A''\n            END AS ds_nfe_tipo\n        , fne.fne_cod\n        , fne.fne_nome_fantasia\n        , nfe.nfe_vlr_total\n \n \n        , (\n            SELECT TOP 1 i.ipg_dt_vcto\n            FROM cpg c\n            INNER JOIN ipg i\n                ON (\n                        c.cpg_serie = i.ipg_cpg_serie\n                        AND c.cpg_num = i.ipg_cpg_num\n                        )\n            WHERE c.cpg_nfe_serie = nfe_serie\n                AND c.cpg_nfe_num = nfe_num\n                AND c.cpg_nfe_tipo = nfe_tipo\n                AND c.cpg_nfe_fne_cod = nfe_fne_cod\n            ORDER BY i.ipg_dt_vcto\n            ) AS nfe_ipg_dt_vcto\n        , (\n            SELECT count(ipg_parc)\n            FROM cpg c\n            INNER JOIN ipg i\n                ON (\n                        c.cpg_serie = i.ipg_cpg_serie\n                        AND c.cpg_num = i.ipg_cpg_num\n                        )\n            WHERE c.cpg_nfe_serie = nfe_serie\n                AND c.cpg_nfe_num = nfe_num\n                AND c.cpg_nfe_tipo = nfe_tipo\n                AND c.cpg_nfe_fne_cod = nfe_fne_cod\n            ) AS nfe_cpg_parcelas\n        , nfe.nfe_crit_venc\n        , nfe.nfe_parcela_1\n        , nfe.nfe_dt_emissao\n        , nfe.nfe_dt_entrada\n        , ine.ine_seq\n        , ine.ine_mat_cod\n        , mat.mat_desc_resumida\n        , mat.mat_lma_cod\n        , lma.lma_nome\n        , mat.mat_gmm_cod\n        , gmm.gmm_nome\n        , mat_unm_cod_entrada\n        , ine.ine_qtde AS ine_qtde_entrada\n        , ine.ine_vlr_unit AS ine_vlr_unit_entrada\n        , (\n            SELECT isnull(sum(ipg_valor), 0)\n            FROM cpg c\n            INNER JOIN ipg i\n                ON (\n                        c.cpg_serie = i.ipg_cpg_serie\n                        AND c.cpg_num = i.ipg_cpg_num\n                        )\n            WHERE c.cpg_nfe_serie = nfe_serie\n                AND c.cpg_nfe_num = nfe_num\n                AND c.cpg_nfe_tipo = nfe_tipo\n                AND c.cpg_nfe_fne_cod = nfe_fne_cod\n                AND i.ipg_status IN (''A'', ''R'')\n                AND i.ipg_dt_vcto <= @DT_FIM\n            ) AS nfe_ipg_aberto\n        , mat_unm_cod_saida\n        , '' AS solic\n        , '' AS DATA_solic\n        , convert(VARCHAR, ine_aft_serie) + ''.'' + convert(VARCHAR, ine_aft_num) AS nfe_aft\n        , aft_dthr\n        , ine.ine_qtde * mat_fat_conv_s_v AS ine_qtde_saida\n        , ine.ine_vlr_unit / mat_fat_conv_s_v AS ine_vlr_saida\n        , ine.ine_vlr_ipi\n        , ine.ine_vlr_desconto\n        , (\n            SELECT TOP 1 f.fne_cod\n            FROM nfe n WITH (NOLOCK)\n            INNER JOIN ine i WITH (NOLOCK)\n                ON (\n                        n.nfe_fne_cod = i.ine_fne_cod\n                        AND n.nfe_serie = i.ine_nfe_serie\n                        AND n.nfe_num = i.ine_nfe_num\n                        AND n.nfe_tipo = i.ine_nfe_tipo\n                          )\n            LEFT OUTER JOIN fne f WITH (NOLOCK)\n                ON ine.ine_fne_cod = fne.fne_cod\n            WHERE i.ine_mat_cod = ine.ine_mat_cod\n                AND f.fne_cod = ine.ine_fne_cod\n                AND (\n                    n.nfe_dt_entrada >= @DT_INICIO\n                    AND n.nfe_dt_entrada <= @DT_FIM\n                    )\n            ORDER BY n.nfe_dt_entrada DESC\n            ) AS ine_fne_cod\n        , (\n            SELECT TOP 1 f.fne_nome_fantasia\n            FROM nfe n WITH (NOLOCK)\n            INNER JOIN ine i WITH (NOLOCK)\n                ON (\n                        n.nfe_fne_cod = i.ine_fne_cod\n                        AND n.nfe_serie = i.ine_nfe_serie\n                        AND n.nfe_num = i.ine_nfe_num\n                        AND n.nfe_tipo = i.ine_nfe_tipo\n                        )\n            LEFT OUTER JOIN fne f WITH (NOLOCK)\n                ON ine.ine_fne_cod = fne.fne_cod\n            WHERE i.ine_mat_cod = ine.ine_mat_cod\n                AND f.fne_cod = ine.ine_fne_cod\n                AND (\n                   n.nfe_dt_entrada >= @DT_INICIO\n                 AND n.nfe_dt_entrada <= @DT_FIM\n                    )\n            ORDER BY n.nfe_dt_entrada DESC\n            ) AS ine_fne_nome_fantasia\n        , replace(replace(replace(emp_cgc, ''.'', ''''), ''/'', ''''), ''-'', '''') AS emp_cgc\n    FROM nfe WITH (NOLOCK)\n    INNER JOIN ine WITH (NOLOCK)\n        ON (\n                nfe.nfe_fne_cod = ine.ine_fne_cod\n                AND nfe.nfe_serie = ine.ine_nfe_serie\n                AND nfe.nfe_num = ine.ine_nfe_num\n                AND nfe.nfe_tipo = ine.ine_nfe_tipo\n                )\n    LEFT OUTER JOIN fne WITH (NOLOCK)\n        ON (convert(VARCHAR, ine.ine_fne_cod) = convert(VARCHAR, fne.fne_cod))\n    LEFT OUTER JOIN mat WITH (NOLOCK)\n        ON (mat.mat_cod = ine.ine_mat_cod)\n    LEFT OUTER JOIN lma WITH (NOLOCK)\n       ON (\n                lma.lma_cod = mat.mat_lma_cod\n                AND lma.lma_gmm_cod = mat.mat_gmm_cod\n                )\n    LEFT OUTER JOIN gmm WITH (NOLOCK)\n        ON (lma.lma_gmm_cod = gmm.gmm_cod)\n    LEFT OUTER JOIN sba WITH (NOLOCK)\n        ON (sba.sba_cod = nfe.nfe_sba_cod)\n    LEFT OUTER JOIN aft WITH (NOLOCK)\n        ON (\n               aft_serie = ine_aft_serie\n                AND aft_num = ine_aft_num\n                )\n    LEFT OUTER JOIN emp WITH (NOLOCK)\n        ON (emp.emp_fne_cod = fne.FNE_COD)\n    CROSS JOIN cfg\n    WHERE (\n            nfe.nfe_dt_entrada >= @DT_INICIO\n            AND nfe.nfe_dt_entrada <= @DT_FIM\n            )\n        AND (\n            fne.fne_cod IN (''%'')\n            OR (''%'' IN (''%''))\n            )\n    ) AS t1\nORDER BY sba_cod\n    , sba_nome\n    , nfe_tipo\n    , nfe_dt_entrada\n    , nfe_serie\n    , nfe_num\n    , ine_seq\n '\n\n)\n",
										"type": "Expression"
									},
									"queryTimeout": "02:00:00",
									"partitionOption": "None"
								},
								"sink": {
									"type": "AzureSqlSink",
									"writeBehavior": "insert",
									"sqlWriterUseTableLock": false,
									"tableOption": "autoCreate",
									"disableMetricsCollection": false
								},
								"enableStaging": false,
								"translator": {
									"type": "TabularTranslator",
									"typeConversion": true,
									"typeConversionSettings": {
										"allowDataTruncation": true,
										"treatBooleanAsNumber": false
									}
								}
							},
							"inputs": [
								{
									"referenceName": "SMART_ITAIGARA_PrdDataSet",
									"type": "DatasetReference"
								}
							],
							"outputs": [
								{
									"referenceName": "AZSQL_DINAMICO",
									"type": "DatasetReference",
									"parameters": {
										"schema_destino": "STG",
										"tabela_destino": "SUP_NFS_SMART_XPTO"
									}
								}
							]
						},
						{
							"name": "NF ITB",
							"type": "Copy",
							"dependsOn": [
								{
									"activity": "NF ITG",
									"dependencyConditions": [
										"Succeeded"
									]
								}
							],
							"policy": {
								"timeout": "7.00:00:00",
								"retry": 0,
								"retryIntervalInSeconds": 30,
								"secureOutput": false,
								"secureInput": false
							},
							"userProperties": [],
							"typeProperties": {
								"source": {
									"type": "SqlServerSource",
									"sqlReaderQuery": "@concat(\r\n'DECLARE @DT_INICIO AS DATE\r\n DECLARE @DT_FIM     AS DATE\r\n\r\nSET @DT_INICIO = ','''', item().DT_INICIO,'''',\r\n'SET @DT_FIM = '  , '''', item().DT_FIM,'''',\r\n' SELECT \r\n 91 as estabelecimento  ',\r\n\r\n '\r\n     ,nfe_dt_emissao\r\n    , nfe_dt_entrada\r\n    , nfe_tipo\r\n    , nfe_serie\r\n    , nfe_num\r\n    , fne_cod\r\n    , fne_nome_fantasia\r\n    , ine_mat_cod\r\n    , mat_desc_resumida\r\n    , gmm_nome\r\n    , ine_qtde_entrada\r\n    , mat_unm_cod_entrada\r\n    , ine_vlr_unit_entrada\r\n    , nfe_ipg_aberto\r\n    , ine_vlr_desconto\r\n    , ine_vlr_ipi\r\n    , nfe_aft\r\n    , nfe_vlr_total\r\n    , ds_nfe_tipo\r\n    , nfe_crit_venc\r\n    , nfe_cpg_parcelas\r\n    , nfe_ipg_dt_vcto\r\n    , nfe_parcela_1\r\nFROM (\r\n    SELECT cfg.cfg_emp\r\n        , sba.sba_cod\r\n        , sba.sba_nome\r\n        , nfe.nfe_serie\r\n        , nfe.nfe_num\r\n        , nfe.nfe_fne_cod\r\n        , nfe.nfe_tipo\r\n        , CASE nfe.nfe_tipo\r\n\r\n                WHEN ''PR''\r\n                THEN ''Entrada''\r\n            WHEN ''SR''\r\n                THEN ''Simples Remessa''\r\n            WHEN ''SF''\r\n                THEN ''Simples Faturamento''\r\n            WHEN ''DV''\r\n                THEN ''Devolução''\r\n            WHEN ''TR''\r\n                THEN ''Transferência''\r\n            ELSE ''N/A''\r\n            END AS ds_nfe_tipo\r\n        , fne.fne_cod\r\n        , fne.fne_nome_fantasia\r\n        , nfe.nfe_vlr_total\r\n \r\n \r\n        , (\r\n            SELECT TOP 1 i.ipg_dt_vcto\r\n            FROM cpg c\r\n            INNER JOIN ipg i\r\n                ON (\r\n                        c.cpg_serie = i.ipg_cpg_serie\r\n                        AND c.cpg_num = i.ipg_cpg_num\r\n                        )\r\n            WHERE c.cpg_nfe_serie = nfe_serie\r\n                AND c.cpg_nfe_num = nfe_num\r\n                AND c.cpg_nfe_tipo = nfe_tipo\r\n                AND c.cpg_nfe_fne_cod = nfe_fne_cod\r\n            ORDER BY i.ipg_dt_vcto\r\n            ) AS nfe_ipg_dt_vcto\r\n        , (\r\n            SELECT count(ipg_parc)\r\n            FROM cpg c\r\n            INNER JOIN ipg i\r\n                ON (\r\n                        c.cpg_serie = i.ipg_cpg_serie\r\n                        AND c.cpg_num = i.ipg_cpg_num\r\n                        )\r\n            WHERE c.cpg_nfe_serie = nfe_serie\r\n                AND c.cpg_nfe_num = nfe_num\r\n                AND c.cpg_nfe_tipo = nfe_tipo\r\n                AND c.cpg_nfe_fne_cod = nfe_fne_cod\r\n            ) AS nfe_cpg_parcelas\r\n        , nfe.nfe_crit_venc\r\n        , nfe.nfe_parcela_1\r\n        , nfe.nfe_dt_emissao\r\n        , nfe.nfe_dt_entrada\r\n        , ine.ine_seq\r\n        , ine.ine_mat_cod\r\n        , mat.mat_desc_resumida\r\n        , mat.mat_lma_cod\r\n        , lma.lma_nome\r\n        , mat.mat_gmm_cod\r\n        , gmm.gmm_nome\r\n        , mat_unm_cod_entrada\r\n        , ine.ine_qtde AS ine_qtde_entrada\r\n        , ine.ine_vlr_unit AS ine_vlr_unit_entrada\r\n        , (\r\n            SELECT isnull(sum(ipg_valor), 0)\r\n            FROM cpg c\r\n            INNER JOIN ipg i\r\n                ON (\r\n                        c.cpg_serie = i.ipg_cpg_serie\r\n                        AND c.cpg_num = i.ipg_cpg_num\r\n                        )\r\n            WHERE c.cpg_nfe_serie = nfe_serie\r\n                AND c.cpg_nfe_num = nfe_num\r\n                AND c.cpg_nfe_tipo = nfe_tipo\r\n                AND c.cpg_nfe_fne_cod = nfe_fne_cod\r\n                AND i.ipg_status IN (''A'', ''R'')\r\n                AND i.ipg_dt_vcto <= @DT_FIM\r\n            ) AS nfe_ipg_aberto\r\n        , mat_unm_cod_saida\r\n        , '' AS solic\r\n        , '' AS DATA_solic\r\n        , convert(VARCHAR, ine_aft_serie) + ''.'' + convert(VARCHAR, ine_aft_num) AS nfe_aft\r\n        , aft_dthr\r\n        , ine.ine_qtde * mat_fat_conv_s_v AS ine_qtde_saida\r\n        , ine.ine_vlr_unit / mat_fat_conv_s_v AS ine_vlr_saida\r\n        , ine.ine_vlr_ipi\r\n        , ine.ine_vlr_desconto\r\n        , (\r\n            SELECT TOP 1 f.fne_cod\r\n            FROM nfe n WITH (NOLOCK)\r\n            INNER JOIN ine i WITH (NOLOCK)\r\n                ON (\r\n                        n.nfe_fne_cod = i.ine_fne_cod\r\n                        AND n.nfe_serie = i.ine_nfe_serie\r\n                        AND n.nfe_num = i.ine_nfe_num\r\n                        AND n.nfe_tipo = i.ine_nfe_tipo\r\n                          )\r\n            LEFT OUTER JOIN fne f WITH (NOLOCK)\r\n                ON ine.ine_fne_cod = fne.fne_cod\r\n            WHERE i.ine_mat_cod = ine.ine_mat_cod\r\n                AND f.fne_cod = ine.ine_fne_cod\r\n                AND (\r\n                    n.nfe_dt_entrada >= @DT_INICIO\r\n                    AND n.nfe_dt_entrada <= @DT_FIM\r\n                    )\r\n            ORDER BY n.nfe_dt_entrada DESC\r\n            ) AS ine_fne_cod\r\n        , (\r\n            SELECT TOP 1 f.fne_nome_fantasia\r\n            FROM nfe n WITH (NOLOCK)\r\n            INNER JOIN ine i WITH (NOLOCK)\r\n                ON (\r\n                        n.nfe_fne_cod = i.ine_fne_cod\r\n                        AND n.nfe_serie = i.ine_nfe_serie\r\n                        AND n.nfe_num = i.ine_nfe_num\r\n                        AND n.nfe_tipo = i.ine_nfe_tipo\r\n                        )\r\n            LEFT OUTER JOIN fne f WITH (NOLOCK)\r\n                ON ine.ine_fne_cod = fne.fne_cod\r\n            WHERE i.ine_mat_cod = ine.ine_mat_cod\r\n                AND f.fne_cod = ine.ine_fne_cod\r\n                AND (\r\n                   n.nfe_dt_entrada >= @DT_INICIO\r\n                 AND n.nfe_dt_entrada <= @DT_FIM\r\n                    )\r\n            ORDER BY n.nfe_dt_entrada DESC\r\n            ) AS ine_fne_nome_fantasia\r\n        , replace(replace(replace(emp_cgc, ''.'', ''''), ''/'', ''''), ''-'', '''') AS emp_cgc\r\n    FROM nfe WITH (NOLOCK)\r\n    INNER JOIN ine WITH (NOLOCK)\r\n        ON (\r\n                nfe.nfe_fne_cod = ine.ine_fne_cod\r\n                AND nfe.nfe_serie = ine.ine_nfe_serie\r\n                AND nfe.nfe_num = ine.ine_nfe_num\r\n                AND nfe.nfe_tipo = ine.ine_nfe_tipo\r\n                )\r\n    LEFT OUTER JOIN fne WITH (NOLOCK)\r\n        ON (convert(VARCHAR, ine.ine_fne_cod) = convert(VARCHAR, fne.fne_cod))\r\n    LEFT OUTER JOIN mat WITH (NOLOCK)\r\n        ON (mat.mat_cod = ine.ine_mat_cod)\r\n    LEFT OUTER JOIN lma WITH (NOLOCK)\r\n       ON (\r\n                lma.lma_cod = mat.mat_lma_cod\r\n                AND lma.lma_gmm_cod = mat.mat_gmm_cod\r\n                )\r\n    LEFT OUTER JOIN gmm WITH (NOLOCK)\r\n        ON (lma.lma_gmm_cod = gmm.gmm_cod)\r\n    LEFT OUTER JOIN sba WITH (NOLOCK)\r\n        ON (sba.sba_cod = nfe.nfe_sba_cod)\r\n    LEFT OUTER JOIN aft WITH (NOLOCK)\r\n        ON (\r\n               aft_serie = ine_aft_serie\r\n                AND aft_num = ine_aft_num\r\n                )\r\n    LEFT OUTER JOIN emp WITH (NOLOCK)\r\n        ON (emp.emp_fne_cod = fne.FNE_COD)\r\n    CROSS JOIN cfg\r\n    WHERE (\r\n            nfe.nfe_dt_entrada >= @DT_INICIO\r\n            AND nfe.nfe_dt_entrada <= @DT_FIM\r\n            )\r\n        AND (\r\n            fne.fne_cod IN (''%'')\r\n            OR (''%'' IN (''%''))\r\n            )\r\n    ) AS t1\r\nORDER BY sba_cod\r\n    , sba_nome\r\n    , nfe_tipo\r\n    , nfe_dt_entrada\r\n    , nfe_serie\r\n    , nfe_num\r\n    , ine_seq\r\n '\r\n\r\n)\r\n",
									"queryTimeout": "02:00:00",
									"partitionOption": "None"
								},
								"sink": {
									"type": "AzureSqlSink",
									"writeBehavior": "insert",
									"sqlWriterUseTableLock": false,
									"tableOption": "autoCreate",
									"disableMetricsCollection": false
								},
								"enableStaging": false,
								"translator": {
									"type": "TabularTranslator",
									"typeConversion": true,
									"typeConversionSettings": {
										"allowDataTruncation": true,
										"treatBooleanAsNumber": false
									}
								}
							},
							"inputs": [
								{
									"referenceName": "SMART_ITABUNA_PrdDataSet",
									"type": "DatasetReference"
								}
							],
							"outputs": [
								{
									"referenceName": "AZSQL_DINAMICO",
									"type": "DatasetReference",
									"parameters": {
										"schema_destino": "STG",
										"tabela_destino": "SUP_NFS_SMART_XPTO"
									}
								}
							]
						},
						{
							"name": "NF IOF",
							"type": "Copy",
							"dependsOn": [
								{
									"activity": "NF ITB",
									"dependencyConditions": [
										"Succeeded"
									]
								}
							],
							"policy": {
								"timeout": "7.00:00:00",
								"retry": 0,
								"retryIntervalInSeconds": 30,
								"secureOutput": false,
								"secureInput": false
							},
							"userProperties": [],
							"typeProperties": {
								"source": {
									"type": "SqlServerSource",
									"sqlReaderQuery": {
										"value": "@concat(\n'DECLARE @DT_INICIO AS DATE\n DECLARE @DT_FIM     AS DATE\n\nSET @DT_INICIO = ','''', item().DT_INICIO,'''',\n'SET @DT_FIM = '  , '''', item().DT_FIM,'''',\n' SELECT \n 92 as estabelecimento  ',\n\n '\n     ,nfe_dt_emissao\n    , nfe_dt_entrada\n    , nfe_tipo\n    , nfe_serie\n    , nfe_num\n    , fne_cod\n    , fne_nome_fantasia\n    , ine_mat_cod\n    , mat_desc_resumida\n    , gmm_nome\n    , ine_qtde_entrada\n    , mat_unm_cod_entrada\n    , ine_vlr_unit_entrada\n    , nfe_ipg_aberto\n    , ine_vlr_desconto\n    , ine_vlr_ipi\n    , nfe_aft\n    , nfe_vlr_total\n    , ds_nfe_tipo\n    , nfe_crit_venc\n    , nfe_cpg_parcelas\n    , nfe_ipg_dt_vcto\n    , nfe_parcela_1\nFROM (\n    SELECT cfg.cfg_emp\n        , sba.sba_cod\n        , sba.sba_nome\n        , nfe.nfe_serie\n        , nfe.nfe_num\n        , nfe.nfe_fne_cod\n        , nfe.nfe_tipo\n        , CASE nfe.nfe_tipo\n\n                WHEN ''PR''\n                THEN ''Entrada''\n            WHEN ''SR''\n                THEN ''Simples Remessa''\n            WHEN ''SF''\n                THEN ''Simples Faturamento''\n            WHEN ''DV''\n                THEN ''Devolução''\n            WHEN ''TR''\n                THEN ''Transferência''\n            ELSE ''N/A''\n            END AS ds_nfe_tipo\n        , fne.fne_cod\n        , fne.fne_nome_fantasia\n        , nfe.nfe_vlr_total\n \n \n        , (\n            SELECT TOP 1 i.ipg_dt_vcto\n            FROM cpg c\n            INNER JOIN ipg i\n                ON (\n                        c.cpg_serie = i.ipg_cpg_serie\n                        AND c.cpg_num = i.ipg_cpg_num\n                        )\n            WHERE c.cpg_nfe_serie = nfe_serie\n                AND c.cpg_nfe_num = nfe_num\n                AND c.cpg_nfe_tipo = nfe_tipo\n                AND c.cpg_nfe_fne_cod = nfe_fne_cod\n            ORDER BY i.ipg_dt_vcto\n            ) AS nfe_ipg_dt_vcto\n        , (\n            SELECT count(ipg_parc)\n            FROM cpg c\n            INNER JOIN ipg i\n                ON (\n                        c.cpg_serie = i.ipg_cpg_serie\n                        AND c.cpg_num = i.ipg_cpg_num\n                        )\n            WHERE c.cpg_nfe_serie = nfe_serie\n                AND c.cpg_nfe_num = nfe_num\n                AND c.cpg_nfe_tipo = nfe_tipo\n                AND c.cpg_nfe_fne_cod = nfe_fne_cod\n            ) AS nfe_cpg_parcelas\n        , nfe.nfe_crit_venc\n        , nfe.nfe_parcela_1\n        , nfe.nfe_dt_emissao\n        , nfe.nfe_dt_entrada\n        , ine.ine_seq\n        , ine.ine_mat_cod\n        , mat.mat_desc_resumida\n        , mat.mat_lma_cod\n        , lma.lma_nome\n        , mat.mat_gmm_cod\n        , gmm.gmm_nome\n        , mat_unm_cod_entrada\n        , ine.ine_qtde AS ine_qtde_entrada\n        , ine.ine_vlr_unit AS ine_vlr_unit_entrada\n        , (\n            SELECT isnull(sum(ipg_valor), 0)\n            FROM cpg c\n            INNER JOIN ipg i\n                ON (\n                        c.cpg_serie = i.ipg_cpg_serie\n                        AND c.cpg_num = i.ipg_cpg_num\n                        )\n            WHERE c.cpg_nfe_serie = nfe_serie\n                AND c.cpg_nfe_num = nfe_num\n                AND c.cpg_nfe_tipo = nfe_tipo\n                AND c.cpg_nfe_fne_cod = nfe_fne_cod\n                AND i.ipg_status IN (''A'', ''R'')\n                AND i.ipg_dt_vcto <= @DT_FIM\n            ) AS nfe_ipg_aberto\n        , mat_unm_cod_saida\n        , '' AS solic\n        , '' AS DATA_solic\n        , convert(VARCHAR, ine_aft_serie) + ''.'' + convert(VARCHAR, ine_aft_num) AS nfe_aft\n        , aft_dthr\n        , ine.ine_qtde * mat_fat_conv_s_v AS ine_qtde_saida\n        , ine.ine_vlr_unit / mat_fat_conv_s_v AS ine_vlr_saida\n        , ine.ine_vlr_ipi\n        , ine.ine_vlr_desconto\n        , (\n            SELECT TOP 1 f.fne_cod\n            FROM nfe n WITH (NOLOCK)\n            INNER JOIN ine i WITH (NOLOCK)\n                ON (\n                        n.nfe_fne_cod = i.ine_fne_cod\n                        AND n.nfe_serie = i.ine_nfe_serie\n                        AND n.nfe_num = i.ine_nfe_num\n                        AND n.nfe_tipo = i.ine_nfe_tipo\n                          )\n            LEFT OUTER JOIN fne f WITH (NOLOCK)\n                ON ine.ine_fne_cod = fne.fne_cod\n            WHERE i.ine_mat_cod = ine.ine_mat_cod\n                AND f.fne_cod = ine.ine_fne_cod\n                AND (\n                    n.nfe_dt_entrada >= @DT_INICIO\n                    AND n.nfe_dt_entrada <= @DT_FIM\n                    )\n            ORDER BY n.nfe_dt_entrada DESC\n            ) AS ine_fne_cod\n        , (\n            SELECT TOP 1 f.fne_nome_fantasia\n            FROM nfe n WITH (NOLOCK)\n            INNER JOIN ine i WITH (NOLOCK)\n                ON (\n                        n.nfe_fne_cod = i.ine_fne_cod\n                        AND n.nfe_serie = i.ine_nfe_serie\n                        AND n.nfe_num = i.ine_nfe_num\n                        AND n.nfe_tipo = i.ine_nfe_tipo\n                        )\n            LEFT OUTER JOIN fne f WITH (NOLOCK)\n                ON ine.ine_fne_cod = fne.fne_cod\n            WHERE i.ine_mat_cod = ine.ine_mat_cod\n                AND f.fne_cod = ine.ine_fne_cod\n                AND (\n                   n.nfe_dt_entrada >= @DT_INICIO\n                 AND n.nfe_dt_entrada <= @DT_FIM\n                    )\n            ORDER BY n.nfe_dt_entrada DESC\n            ) AS ine_fne_nome_fantasia\n        , replace(replace(replace(emp_cgc, ''.'', ''''), ''/'', ''''), ''-'', '''') AS emp_cgc\n    FROM nfe WITH (NOLOCK)\n    INNER JOIN ine WITH (NOLOCK)\n        ON (\n                nfe.nfe_fne_cod = ine.ine_fne_cod\n                AND nfe.nfe_serie = ine.ine_nfe_serie\n                AND nfe.nfe_num = ine.ine_nfe_num\n                AND nfe.nfe_tipo = ine.ine_nfe_tipo\n                )\n    LEFT OUTER JOIN fne WITH (NOLOCK)\n        ON (convert(VARCHAR, ine.ine_fne_cod) = convert(VARCHAR, fne.fne_cod))\n    LEFT OUTER JOIN mat WITH (NOLOCK)\n        ON (mat.mat_cod = ine.ine_mat_cod)\n    LEFT OUTER JOIN lma WITH (NOLOCK)\n       ON (\n                lma.lma_cod = mat.mat_lma_cod\n                AND lma.lma_gmm_cod = mat.mat_gmm_cod\n                )\n    LEFT OUTER JOIN gmm WITH (NOLOCK)\n        ON (lma.lma_gmm_cod = gmm.gmm_cod)\n    LEFT OUTER JOIN sba WITH (NOLOCK)\n        ON (sba.sba_cod = nfe.nfe_sba_cod)\n    LEFT OUTER JOIN aft WITH (NOLOCK)\n        ON (\n               aft_serie = ine_aft_serie\n                AND aft_num = ine_aft_num\n                )\n    LEFT OUTER JOIN emp WITH (NOLOCK)\n        ON (emp.emp_fne_cod = fne.FNE_COD)\n    CROSS JOIN cfg\n    WHERE (\n            nfe.nfe_dt_entrada >= @DT_INICIO\n            AND nfe.nfe_dt_entrada <= @DT_FIM\n            )\n        AND (\n            fne.fne_cod IN (''%'')\n            OR (''%'' IN (''%''))\n            )\n    ) AS t1\nORDER BY sba_cod\n    , sba_nome\n    , nfe_tipo\n    , nfe_dt_entrada\n    , nfe_serie\n    , nfe_num\n    , ine_seq\n '\n\n)\n",
										"type": "Expression"
									},
									"queryTimeout": "02:00:00",
									"partitionOption": "None"
								},
								"sink": {
									"type": "AzureSqlSink",
									"writeBehavior": "insert",
									"sqlWriterUseTableLock": false,
									"tableOption": "autoCreate",
									"disableMetricsCollection": false
								},
								"enableStaging": false,
								"translator": {
									"type": "TabularTranslator",
									"typeConversion": true,
									"typeConversionSettings": {
										"allowDataTruncation": true,
										"treatBooleanAsNumber": false
									}
								}
							},
							"inputs": [
								{
									"referenceName": "SMART_IOF_PrdDataSet",
									"type": "DatasetReference"
								}
							],
							"outputs": [
								{
									"referenceName": "AZSQL_DINAMICO",
									"type": "DatasetReference",
									"parameters": {
										"schema_destino": "STG",
										"tabela_destino": "SUP_NFS_SMART_XPTO"
									}
								}
							]
						},
						{
							"name": "NF OFT",
							"type": "Copy",
							"dependsOn": [
								{
									"activity": "NF IOF",
									"dependencyConditions": [
										"Succeeded"
									]
								}
							],
							"policy": {
								"timeout": "7.00:00:00",
								"retry": 0,
								"retryIntervalInSeconds": 30,
								"secureOutput": false,
								"secureInput": false
							},
							"userProperties": [],
							"typeProperties": {
								"source": {
									"type": "SqlServerSource",
									"sqlReaderQuery": "@concat(\r\n'DECLARE @DT_INICIO AS DATE\r\n DECLARE @DT_FIM     AS DATE\r\n\r\nSET @DT_INICIO = ','''', item().DT_INICIO,'''',\r\n'SET @DT_FIM = '  , '''', item().DT_FIM,'''',\r\n' SELECT \r\n 93 as estabelecimento  ',\r\n\r\n '\r\n     ,nfe_dt_emissao\r\n    , nfe_dt_entrada\r\n    , nfe_tipo\r\n    , nfe_serie\r\n    , nfe_num\r\n    , fne_cod\r\n    , fne_nome_fantasia\r\n    , ine_mat_cod\r\n    , mat_desc_resumida\r\n    , gmm_nome\r\n    , ine_qtde_entrada\r\n    , mat_unm_cod_entrada\r\n    , ine_vlr_unit_entrada\r\n    , nfe_ipg_aberto\r\n    , ine_vlr_desconto\r\n    , ine_vlr_ipi\r\n    , nfe_aft\r\n    , nfe_vlr_total\r\n    , ds_nfe_tipo\r\n    , nfe_crit_venc\r\n    , nfe_cpg_parcelas\r\n    , nfe_ipg_dt_vcto\r\n    , nfe_parcela_1\r\nFROM (\r\n    SELECT cfg.cfg_emp\r\n        , sba.sba_cod\r\n        , sba.sba_nome\r\n        , nfe.nfe_serie\r\n        , nfe.nfe_num\r\n        , nfe.nfe_fne_cod\r\n        , nfe.nfe_tipo\r\n        , CASE nfe.nfe_tipo\r\n\r\n                WHEN ''PR''\r\n                THEN ''Entrada''\r\n            WHEN ''SR''\r\n                THEN ''Simples Remessa''\r\n            WHEN ''SF''\r\n                THEN ''Simples Faturamento''\r\n            WHEN ''DV''\r\n                THEN ''Devolução''\r\n            WHEN ''TR''\r\n                THEN ''Transferência''\r\n            ELSE ''N/A''\r\n            END AS ds_nfe_tipo\r\n        , fne.fne_cod\r\n        , fne.fne_nome_fantasia\r\n        , nfe.nfe_vlr_total\r\n \r\n \r\n        , (\r\n            SELECT TOP 1 i.ipg_dt_vcto\r\n            FROM cpg c\r\n            INNER JOIN ipg i\r\n                ON (\r\n                        c.cpg_serie = i.ipg_cpg_serie\r\n                        AND c.cpg_num = i.ipg_cpg_num\r\n                        )\r\n            WHERE c.cpg_nfe_serie = nfe_serie\r\n                AND c.cpg_nfe_num = nfe_num\r\n                AND c.cpg_nfe_tipo = nfe_tipo\r\n                AND c.cpg_nfe_fne_cod = nfe_fne_cod\r\n            ORDER BY i.ipg_dt_vcto\r\n            ) AS nfe_ipg_dt_vcto\r\n        , (\r\n            SELECT count(ipg_parc)\r\n            FROM cpg c\r\n            INNER JOIN ipg i\r\n                ON (\r\n                        c.cpg_serie = i.ipg_cpg_serie\r\n                        AND c.cpg_num = i.ipg_cpg_num\r\n                        )\r\n            WHERE c.cpg_nfe_serie = nfe_serie\r\n                AND c.cpg_nfe_num = nfe_num\r\n                AND c.cpg_nfe_tipo = nfe_tipo\r\n                AND c.cpg_nfe_fne_cod = nfe_fne_cod\r\n            ) AS nfe_cpg_parcelas\r\n        , nfe.nfe_crit_venc\r\n        , nfe.nfe_parcela_1\r\n        , nfe.nfe_dt_emissao\r\n        , nfe.nfe_dt_entrada\r\n        , ine.ine_seq\r\n        , ine.ine_mat_cod\r\n        , mat.mat_desc_resumida\r\n        , mat.mat_lma_cod\r\n        , lma.lma_nome\r\n        , mat.mat_gmm_cod\r\n        , gmm.gmm_nome\r\n        , mat_unm_cod_entrada\r\n        , ine.ine_qtde AS ine_qtde_entrada\r\n        , ine.ine_vlr_unit AS ine_vlr_unit_entrada\r\n        , (\r\n            SELECT isnull(sum(ipg_valor), 0)\r\n            FROM cpg c\r\n            INNER JOIN ipg i\r\n                ON (\r\n                        c.cpg_serie = i.ipg_cpg_serie\r\n                        AND c.cpg_num = i.ipg_cpg_num\r\n                        )\r\n            WHERE c.cpg_nfe_serie = nfe_serie\r\n                AND c.cpg_nfe_num = nfe_num\r\n                AND c.cpg_nfe_tipo = nfe_tipo\r\n                AND c.cpg_nfe_fne_cod = nfe_fne_cod\r\n                AND i.ipg_status IN (''A'', ''R'')\r\n                AND i.ipg_dt_vcto <= @DT_FIM\r\n            ) AS nfe_ipg_aberto\r\n        , mat_unm_cod_saida\r\n        , '' AS solic\r\n        , '' AS DATA_solic\r\n        , convert(VARCHAR, ine_aft_serie) + ''.'' + convert(VARCHAR, ine_aft_num) AS nfe_aft\r\n        , aft_dthr\r\n        , ine.ine_qtde * mat_fat_conv_s_v AS ine_qtde_saida\r\n        , ine.ine_vlr_unit / mat_fat_conv_s_v AS ine_vlr_saida\r\n        , ine.ine_vlr_ipi\r\n        , ine.ine_vlr_desconto\r\n        , (\r\n            SELECT TOP 1 f.fne_cod\r\n            FROM nfe n WITH (NOLOCK)\r\n            INNER JOIN ine i WITH (NOLOCK)\r\n                ON (\r\n                        n.nfe_fne_cod = i.ine_fne_cod\r\n                        AND n.nfe_serie = i.ine_nfe_serie\r\n                        AND n.nfe_num = i.ine_nfe_num\r\n                        AND n.nfe_tipo = i.ine_nfe_tipo\r\n                          )\r\n            LEFT OUTER JOIN fne f WITH (NOLOCK)\r\n                ON ine.ine_fne_cod = fne.fne_cod\r\n            WHERE i.ine_mat_cod = ine.ine_mat_cod\r\n                AND f.fne_cod = ine.ine_fne_cod\r\n                AND (\r\n                    n.nfe_dt_entrada >= @DT_INICIO\r\n                    AND n.nfe_dt_entrada <= @DT_FIM\r\n                    )\r\n            ORDER BY n.nfe_dt_entrada DESC\r\n            ) AS ine_fne_cod\r\n        , (\r\n            SELECT TOP 1 f.fne_nome_fantasia\r\n            FROM nfe n WITH (NOLOCK)\r\n            INNER JOIN ine i WITH (NOLOCK)\r\n                ON (\r\n                        n.nfe_fne_cod = i.ine_fne_cod\r\n                        AND n.nfe_serie = i.ine_nfe_serie\r\n                        AND n.nfe_num = i.ine_nfe_num\r\n                        AND n.nfe_tipo = i.ine_nfe_tipo\r\n                        )\r\n            LEFT OUTER JOIN fne f WITH (NOLOCK)\r\n                ON ine.ine_fne_cod = fne.fne_cod\r\n            WHERE i.ine_mat_cod = ine.ine_mat_cod\r\n                AND f.fne_cod = ine.ine_fne_cod\r\n                AND (\r\n                   n.nfe_dt_entrada >= @DT_INICIO\r\n                 AND n.nfe_dt_entrada <= @DT_FIM\r\n                    )\r\n            ORDER BY n.nfe_dt_entrada DESC\r\n            ) AS ine_fne_nome_fantasia\r\n        , replace(replace(replace(emp_cgc, ''.'', ''''), ''/'', ''''), ''-'', '''') AS emp_cgc\r\n    FROM nfe WITH (NOLOCK)\r\n    INNER JOIN ine WITH (NOLOCK)\r\n        ON (\r\n                nfe.nfe_fne_cod = ine.ine_fne_cod\r\n                AND nfe.nfe_serie = ine.ine_nfe_serie\r\n                AND nfe.nfe_num = ine.ine_nfe_num\r\n                AND nfe.nfe_tipo = ine.ine_nfe_tipo\r\n                )\r\n    LEFT OUTER JOIN fne WITH (NOLOCK)\r\n        ON (convert(VARCHAR, ine.ine_fne_cod) = convert(VARCHAR, fne.fne_cod))\r\n    LEFT OUTER JOIN mat WITH (NOLOCK)\r\n        ON (mat.mat_cod = ine.ine_mat_cod)\r\n    LEFT OUTER JOIN lma WITH (NOLOCK)\r\n       ON (\r\n                lma.lma_cod = mat.mat_lma_cod\r\n                AND lma.lma_gmm_cod = mat.mat_gmm_cod\r\n                )\r\n    LEFT OUTER JOIN gmm WITH (NOLOCK)\r\n        ON (lma.lma_gmm_cod = gmm.gmm_cod)\r\n    LEFT OUTER JOIN sba WITH (NOLOCK)\r\n        ON (sba.sba_cod = nfe.nfe_sba_cod)\r\n    LEFT OUTER JOIN aft WITH (NOLOCK)\r\n        ON (\r\n               aft_serie = ine_aft_serie\r\n                AND aft_num = ine_aft_num\r\n                )\r\n    LEFT OUTER JOIN emp WITH (NOLOCK)\r\n        ON (emp.emp_fne_cod = fne.FNE_COD)\r\n    CROSS JOIN cfg\r\n    WHERE (\r\n            nfe.nfe_dt_entrada >= @DT_INICIO\r\n            AND nfe.nfe_dt_entrada <= @DT_FIM\r\n            )\r\n        AND (\r\n            fne.fne_cod IN (''%'')\r\n            OR (''%'' IN (''%''))\r\n            )\r\n    ) AS t1\r\nORDER BY sba_cod\r\n    , sba_nome\r\n    , nfe_tipo\r\n    , nfe_dt_entrada\r\n    , nfe_serie\r\n    , nfe_num\r\n    , ine_seq\r\n '\r\n\r\n)\r\n",
									"queryTimeout": "02:00:00",
									"partitionOption": "None"
								},
								"sink": {
									"type": "AzureSqlSink",
									"writeBehavior": "insert",
									"sqlWriterUseTableLock": false,
									"tableOption": "autoCreate",
									"disableMetricsCollection": false
								},
								"enableStaging": false,
								"translator": {
									"type": "TabularTranslator",
									"typeConversion": true,
									"typeConversionSettings": {
										"allowDataTruncation": true,
										"treatBooleanAsNumber": false
									}
								}
							},
							"inputs": [
								{
									"referenceName": "SMART_Oftalmoclin_Prd_DataSet",
									"type": "DatasetReference"
								}
							],
							"outputs": [
								{
									"referenceName": "AZSQL_DINAMICO",
									"type": "DatasetReference",
									"parameters": {
										"schema_destino": "STG",
										"tabela_destino": "SUP_NFS_SMART_XPTO"
									}
								}
							]
						},
						{
							"name": "NF HOSL",
							"type": "Copy",
							"dependsOn": [
								{
									"activity": "NF OFT",
									"dependencyConditions": [
										"Succeeded"
									]
								}
							],
							"policy": {
								"timeout": "7.00:00:00",
								"retry": 0,
								"retryIntervalInSeconds": 30,
								"secureOutput": false,
								"secureInput": false
							},
							"userProperties": [],
							"typeProperties": {
								"source": {
									"type": "SqlServerSource",
									"sqlReaderQuery": "@concat(\r\n'DECLARE @DT_INICIO AS DATE\r\n DECLARE @DT_FIM     AS DATE\r\n\r\nSET @DT_INICIO = ','''', item().DT_INICIO,'''',\r\n'SET @DT_FIM = '  , '''', item().DT_FIM,'''',\r\n' SELECT \r\n 94 as estabelecimento  ',\r\n\r\n '\r\n     ,nfe_dt_emissao\r\n    , nfe_dt_entrada\r\n    , nfe_tipo\r\n    , nfe_serie\r\n    , nfe_num\r\n    , fne_cod\r\n    , fne_nome_fantasia\r\n    , ine_mat_cod\r\n    , mat_desc_resumida\r\n    , gmm_nome\r\n    , ine_qtde_entrada\r\n    , mat_unm_cod_entrada\r\n    , ine_vlr_unit_entrada\r\n    , nfe_ipg_aberto\r\n    , ine_vlr_desconto\r\n    , ine_vlr_ipi\r\n    , nfe_aft\r\n    , nfe_vlr_total\r\n    , ds_nfe_tipo\r\n    , nfe_crit_venc\r\n    , nfe_cpg_parcelas\r\n    , nfe_ipg_dt_vcto\r\n    , nfe_parcela_1\r\nFROM (\r\n    SELECT cfg.cfg_emp\r\n        , sba.sba_cod\r\n        , sba.sba_nome\r\n        , nfe.nfe_serie\r\n        , nfe.nfe_num\r\n        , nfe.nfe_fne_cod\r\n        , nfe.nfe_tipo\r\n        , CASE nfe.nfe_tipo\r\n\r\n                WHEN ''PR''\r\n                THEN ''Entrada''\r\n            WHEN ''SR''\r\n                THEN ''Simples Remessa''\r\n            WHEN ''SF''\r\n                THEN ''Simples Faturamento''\r\n            WHEN ''DV''\r\n                THEN ''Devolução''\r\n            WHEN ''TR''\r\n                THEN ''Transferência''\r\n            ELSE ''N/A''\r\n            END AS ds_nfe_tipo\r\n        , fne.fne_cod\r\n        , fne.fne_nome_fantasia\r\n        , nfe.nfe_vlr_total\r\n \r\n \r\n        , (\r\n            SELECT TOP 1 i.ipg_dt_vcto\r\n            FROM cpg c\r\n            INNER JOIN ipg i\r\n                ON (\r\n                        c.cpg_serie = i.ipg_cpg_serie\r\n                        AND c.cpg_num = i.ipg_cpg_num\r\n                        )\r\n            WHERE c.cpg_nfe_serie = nfe_serie\r\n                AND c.cpg_nfe_num = nfe_num\r\n                AND c.cpg_nfe_tipo = nfe_tipo\r\n                AND c.cpg_nfe_fne_cod = nfe_fne_cod\r\n            ORDER BY i.ipg_dt_vcto\r\n            ) AS nfe_ipg_dt_vcto\r\n        , (\r\n            SELECT count(ipg_parc)\r\n            FROM cpg c\r\n            INNER JOIN ipg i\r\n                ON (\r\n                        c.cpg_serie = i.ipg_cpg_serie\r\n                        AND c.cpg_num = i.ipg_cpg_num\r\n                        )\r\n            WHERE c.cpg_nfe_serie = nfe_serie\r\n                AND c.cpg_nfe_num = nfe_num\r\n                AND c.cpg_nfe_tipo = nfe_tipo\r\n                AND c.cpg_nfe_fne_cod = nfe_fne_cod\r\n            ) AS nfe_cpg_parcelas\r\n        , nfe.nfe_crit_venc\r\n        , nfe.nfe_parcela_1\r\n        , nfe.nfe_dt_emissao\r\n        , nfe.nfe_dt_entrada\r\n        , ine.ine_seq\r\n        , ine.ine_mat_cod\r\n        , mat.mat_desc_resumida\r\n        , mat.mat_lma_cod\r\n        , lma.lma_nome\r\n        , mat.mat_gmm_cod\r\n        , gmm.gmm_nome\r\n        , mat_unm_cod_entrada\r\n        , ine.ine_qtde AS ine_qtde_entrada\r\n        , ine.ine_vlr_unit AS ine_vlr_unit_entrada\r\n        , (\r\n            SELECT isnull(sum(ipg_valor), 0)\r\n            FROM cpg c\r\n            INNER JOIN ipg i\r\n                ON (\r\n                        c.cpg_serie = i.ipg_cpg_serie\r\n                        AND c.cpg_num = i.ipg_cpg_num\r\n                        )\r\n            WHERE c.cpg_nfe_serie = nfe_serie\r\n                AND c.cpg_nfe_num = nfe_num\r\n                AND c.cpg_nfe_tipo = nfe_tipo\r\n                AND c.cpg_nfe_fne_cod = nfe_fne_cod\r\n                AND i.ipg_status IN (''A'', ''R'')\r\n                AND i.ipg_dt_vcto <= @DT_FIM\r\n            ) AS nfe_ipg_aberto\r\n        , mat_unm_cod_saida\r\n        , '' AS solic\r\n        , '' AS DATA_solic\r\n        , convert(VARCHAR, ine_aft_serie) + ''.'' + convert(VARCHAR, ine_aft_num) AS nfe_aft\r\n        , aft_dthr\r\n        , ine.ine_qtde * mat_fat_conv_s_v AS ine_qtde_saida\r\n        , ine.ine_vlr_unit / mat_fat_conv_s_v AS ine_vlr_saida\r\n        , ine.ine_vlr_ipi\r\n        , ine.ine_vlr_desconto\r\n        , (\r\n            SELECT TOP 1 f.fne_cod\r\n            FROM nfe n WITH (NOLOCK)\r\n            INNER JOIN ine i WITH (NOLOCK)\r\n                ON (\r\n                        n.nfe_fne_cod = i.ine_fne_cod\r\n                        AND n.nfe_serie = i.ine_nfe_serie\r\n                        AND n.nfe_num = i.ine_nfe_num\r\n                        AND n.nfe_tipo = i.ine_nfe_tipo\r\n                          )\r\n            LEFT OUTER JOIN fne f WITH (NOLOCK)\r\n                ON ine.ine_fne_cod = fne.fne_cod\r\n            WHERE i.ine_mat_cod = ine.ine_mat_cod\r\n                AND f.fne_cod = ine.ine_fne_cod\r\n                AND (\r\n                    n.nfe_dt_entrada >= @DT_INICIO\r\n                    AND n.nfe_dt_entrada <= @DT_FIM\r\n                    )\r\n            ORDER BY n.nfe_dt_entrada DESC\r\n            ) AS ine_fne_cod\r\n        , (\r\n            SELECT TOP 1 f.fne_nome_fantasia\r\n            FROM nfe n WITH (NOLOCK)\r\n            INNER JOIN ine i WITH (NOLOCK)\r\n                ON (\r\n                        n.nfe_fne_cod = i.ine_fne_cod\r\n                        AND n.nfe_serie = i.ine_nfe_serie\r\n                        AND n.nfe_num = i.ine_nfe_num\r\n                        AND n.nfe_tipo = i.ine_nfe_tipo\r\n                        )\r\n            LEFT OUTER JOIN fne f WITH (NOLOCK)\r\n                ON ine.ine_fne_cod = fne.fne_cod\r\n            WHERE i.ine_mat_cod = ine.ine_mat_cod\r\n                AND f.fne_cod = ine.ine_fne_cod\r\n                AND (\r\n                   n.nfe_dt_entrada >= @DT_INICIO\r\n                 AND n.nfe_dt_entrada <= @DT_FIM\r\n                    )\r\n            ORDER BY n.nfe_dt_entrada DESC\r\n            ) AS ine_fne_nome_fantasia\r\n        , replace(replace(replace(emp_cgc, ''.'', ''''), ''/'', ''''), ''-'', '''') AS emp_cgc\r\n    FROM nfe WITH (NOLOCK)\r\n    INNER JOIN ine WITH (NOLOCK)\r\n        ON (\r\n                nfe.nfe_fne_cod = ine.ine_fne_cod\r\n                AND nfe.nfe_serie = ine.ine_nfe_serie\r\n                AND nfe.nfe_num = ine.ine_nfe_num\r\n                AND nfe.nfe_tipo = ine.ine_nfe_tipo\r\n                )\r\n    LEFT OUTER JOIN fne WITH (NOLOCK)\r\n        ON (convert(VARCHAR, ine.ine_fne_cod) = convert(VARCHAR, fne.fne_cod))\r\n    LEFT OUTER JOIN mat WITH (NOLOCK)\r\n        ON (mat.mat_cod = ine.ine_mat_cod)\r\n    LEFT OUTER JOIN lma WITH (NOLOCK)\r\n       ON (\r\n                lma.lma_cod = mat.mat_lma_cod\r\n                AND lma.lma_gmm_cod = mat.mat_gmm_cod\r\n                )\r\n    LEFT OUTER JOIN gmm WITH (NOLOCK)\r\n        ON (lma.lma_gmm_cod = gmm.gmm_cod)\r\n    LEFT OUTER JOIN sba WITH (NOLOCK)\r\n        ON (sba.sba_cod = nfe.nfe_sba_cod)\r\n    LEFT OUTER JOIN aft WITH (NOLOCK)\r\n        ON (\r\n               aft_serie = ine_aft_serie\r\n                AND aft_num = ine_aft_num\r\n                )\r\n    LEFT OUTER JOIN emp WITH (NOLOCK)\r\n        ON (emp.emp_fne_cod = fne.FNE_COD)\r\n    CROSS JOIN cfg\r\n    WHERE (\r\n            nfe.nfe_dt_entrada >= @DT_INICIO\r\n            AND nfe.nfe_dt_entrada <= @DT_FIM\r\n            )\r\n        AND (\r\n            fne.fne_cod IN (''%'')\r\n            OR (''%'' IN (''%''))\r\n            )\r\n    ) AS t1\r\nORDER BY sba_cod\r\n    , sba_nome\r\n    , nfe_tipo\r\n    , nfe_dt_entrada\r\n    , nfe_serie\r\n    , nfe_num\r\n    , ine_seq\r\n '\r\n\r\n)\r\n",
									"queryTimeout": "02:00:00",
									"partitionOption": "None"
								},
								"sink": {
									"type": "AzureSqlSink",
									"writeBehavior": "insert",
									"sqlWriterUseTableLock": false,
									"tableOption": "autoCreate",
									"disableMetricsCollection": false
								},
								"enableStaging": false,
								"translator": {
									"type": "TabularTranslator",
									"typeConversion": true,
									"typeConversionSettings": {
										"allowDataTruncation": true,
										"treatBooleanAsNumber": false
									}
								}
							},
							"inputs": [
								{
									"referenceName": "SMART_HOSL_PrdDataSet",
									"type": "DatasetReference"
								}
							],
							"outputs": [
								{
									"referenceName": "AZSQL_DINAMICO",
									"type": "DatasetReference",
									"parameters": {
										"schema_destino": "STG",
										"tabela_destino": "SUP_NFS_SMART_XPTO"
									}
								}
							]
						}
					]
				}
			}
		],
		"variables": {
			"DT_INICIO": {
				"type": "String"
			},
			"DT_FIM": {
				"type": "String"
			}
		},
		"folder": {
			"name": "Suprimentos/Nota Fiscal/ELP"
		},
		"annotations": []
	}
}