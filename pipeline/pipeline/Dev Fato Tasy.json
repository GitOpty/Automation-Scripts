{
	"name": "Dev Fato Tasy",
	"properties": {
		"description": "Criado somente para teste ",
		"activities": [
			{
				"name": "Extract Ciclo Tasy",
				"type": "Copy",
				"dependsOn": [],
				"policy": {
					"timeout": "7.00:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "OracleSource",
						"oracleReaderQuery": "WITH TB AS(\n\nSELECT \n    AP.CD_ESTABELECIMENTO,\n    CP.CD_AUTORIZACAO,\n    AP.IE_TIPO_ATENDIMENTO,\n    AP.CD_PESSOA_FISICA,\n    AP.NR_ATENDIMENTO,\n    CP.NR_INTERNO_CONTA,\n    PP.NR_SEQUENCIA,\n    CP.NR_SEQ_PROTOCOLO,\n--    PP.NR_SEQ_PROC_PACOTE,\n --   AP.CD_PROCEDENCIA,\n --   AP.CD_MOTIVO_ALTA,\n --   AP.IE_CARATER_INTER_SUS,\n    CP.CD_CONVENIO_PARAMETRO,\n--    CP.CD_CATEGORIA_PARAMETRO,\n    PP.CD_SETOR_ATENDIMENTO,\n    AP.DT_ENTRADA,\n    PP.DT_PROCEDIMENTO                          AS DT_ITEM,\n    PP.CD_PROCEDIMENTO                          AS CD_ITEM,\n    PP.CD_PROCEDIMENTO_CONVENIO                 AS CD_ITEM_CONVENIO,\n    P.DS_PROC_EXAME                             AS DS_ITEM,\n    PP.NR_SEQ_PROC_INTERNO                      AS NR_PROC_INTERNO,\n    PP.IE_EMITE_CONTA,\n    PP.QT_PROCEDIMENTO                          AS QT_ITEM,\n    CASE \n       WHEN obter_area_procedimento(PP.cd_procedimento, PP.ie_origem_proced) = 10 THEN 0\n       ELSE PP.VL_PROCEDIMENTO\n    END    AS VL_ITEM\n\nFROM  \n    ATENDIMENTO_PACIENTE                    AP\n    INNER JOIN CONTA_PACIENTE               CP ON CP.NR_ATENDIMENTO = AP.NR_ATENDIMENTO\n    INNER JOIN PROCEDIMENTO_PACIENTE        PP ON CP.NR_INTERNO_CONTA = PP.NR_INTERNO_CONTA\n    INNER JOIN SETOR_ATENDIMENTO            SA ON SA.CD_SETOR_ATENDIMENTO = PP.CD_SETOR_ATENDIMENTO\n    INNER JOIN PROC_INTERNO                 P  ON P.NR_SEQUENCIA = PP.NR_SEQ_PROC_INTERNO\n    --LEFT JOIN  TISS_DEM_GLOSA TDG ON TDG.NR_SEQ_CONTA_PROC = PP.NR_SEQUENCIA\n\n    \n\nWHERE\n\n      AP.DT_CANCELAMENTO IS NULL\n      and PP.cd_motivo_exc_conta is null\n      and CP.ie_cancelamento is null\n--      and obter_area_procedimento(PP.cd_procedimento, PP.ie_origem_proced) <> 10\n      AND CP.NR_INTERNO_CONTA IS NOT NULL\n     -- AND AP.NR_ATENDIMENTO =: NR_ATENDIMENTO\n      --AND PP.NR_SEQUENCIA =: NR_SEQ\n      --AND PP.NR_SEQ_PROC_PACOTE IS NULL\n      AND TRUNC(AP.DT_ENTRADA,'MM') BETWEEN to_date('01/02/2021','DD/MM/YYYY') AND TO_DATE('01/04/2021','DD/MM/YYYY')\n --   AND TRUNC(PP.DT_PROCEDIMENTO,'MM') BETWEEN (TO_DATE((EXTRACT(YEAR FROM SYSDATE)-1)||'-01-01','YYYY-MM-DD')- INTERVAL '0.001' SECOND) AND (TO_DATE(TO_CHAR(SYSDATE,'YYYY-MM-DD'),'YYYY-MM-DD') - INTERVAL '0.001' SECOND)\n\nUNION ALL\n\nSELECT \n    AP.CD_ESTABELECIMENTO,\n    CP.CD_AUTORIZACAO,\n    AP.IE_TIPO_ATENDIMENTO,\n    AP.CD_PESSOA_FISICA,\n    AP.NR_ATENDIMENTO,\n    CP.NR_INTERNO_CONTA,\n    MAP.NR_SEQUENCIA,\n    CP.NR_SEQ_PROTOCOLO,\n --   MAP.NR_SEQ_PROC_PACOTE,\n --   AP.CD_PROCEDENCIA,\n --   AP.CD_MOTIVO_ALTA,\n --   AP.IE_CARATER_INTER_SUS,    \n    CP.CD_CONVENIO_PARAMETRO,\n --   CP.CD_CATEGORIA_PARAMETRO,\n    MAP.CD_SETOR_ATENDIMENTO,\n    AP.DT_ENTRADA,\n    MAP.DT_ATENDIMENTO                                      AS DT_ITEM,\n    MAP.CD_MATERIAL                                         AS CD_ITEM,\n    MAP.CD_MATERIAL_CONVENIO                                AS CD_ITEM_CONVENIO,\n    MAT.DS_MATERIAL                                         AS DS_ITEM,\n    0                                                       AS NR_PROC_INTERNO,\n    MAP.IE_EMITE_CONTA,\n    MAP.QT_MATERIAL                                         AS QT_ITEM,\n    MAP.VL_MATERIAL                                         AS VL_ITEM\n    \n\nFROM  \n    ATENDIMENTO_PACIENTE                    AP\n    INNER JOIN CONTA_PACIENTE               CP  ON CP.NR_ATENDIMENTO = AP.NR_ATENDIMENTO\n    INNER JOIN MATERIAL_ATEND_PACIENTE      MAP ON CP.NR_INTERNO_CONTA = MAP.NR_INTERNO_CONTA\n    INNER JOIN SETOR_ATENDIMENTO            SA  ON SA.CD_SETOR_ATENDIMENTO = MAP.CD_SETOR_ATENDIMENTO\n    INNER JOIN MATERIAL                     MAT ON MAT.CD_MATERIAL = MAP.CD_MATERIAL\n    --LEFT JOIN  TISS_DEM_GLOSA TDG ON TDG.NR_SEQ_CONTA_PROC = MAP.NR_SEQUENCIA\n    --LEFT JOIN  TASY.CIRURGIA CIR ON CIR.NR_CIRURGIA = MAP.NR_CIRURGIA\n\n\nWHERE \n      AP.DT_CANCELAMENTO IS NULL\n      and MAP.cd_motivo_exc_conta is null\n      and CP.ie_cancelamento is null\n      AND CP.NR_INTERNO_CONTA IS NOT NULL\n      --AND AP.NR_ATENDIMENTO =: NR_ATENDIMENTO\n      --AND MAP.NR_SEQUENCIA =: NR_SEQ\n      AND TRUNC(AP.DT_ENTRADA,'MM') BETWEEN to_date('01/02/2021','DD/MM/YYYY') AND TO_DATE('01/04/2021','DD/MM/YYYY')\n --   AND TRUNC(MAP.DT_ATENDIMENTO,'MM') BETWEEN (TO_DATE((EXTRACT(YEAR FROM SYSDATE)-1)||'-01-01','YYYY-MM-DD')- INTERVAL '0.001' SECOND) AND (TO_DATE(TO_CHAR(SYSDATE,'YYYY-MM-DD'),'YYYY-MM-DD')- INTERVAL '0.001' SECOND)\n )\nSELECT\nA.CD_PESSOA_FISICA\n,A.NR_ATENDIMENTO\n,A.NR_INTERNO_CONTA\n,ACC.CD_USUARIO_CONVENIO                                   AS CD_CARTERINHA_PAC\n,A.CD_AUTORIZACAO                                          AS NR_GUIA\n,SENHA.CD_SENHA                                            AS SENHA_CONV\n,CONV.CD_CGC                                               AS CGC_CONVENIO\n,CONV.CD_CONVENIO\n,CONV.DS_CONVENIO\n,A.DT_ENTRADA\n,A.CD_ESTABELECIMENTO\n,SA.DS_SETOR_ATENDIMENTO\n,A.DT_ITEM                                                AS DT_LANC_ITEM\n,CPE.DS_ESTRUTURA                                         AS CLASSIF_ITEM\n,A.NR_SEQUENCIA\n,A.CD_ITEM\n,A.DS_ITEM\n,PC.DT_PERIODO_INICIAL                                    AS DT_INICIO_PRE_FAT\n,PC.DT_ENVIO\n,NVL(TRL.NR_TITULO,0)                                     AS NR_TITULO\n,NVL(NF.DT_EMISSAO,PC.DT_MESANO_REFERENCIA)               AS DT_EMISSAO_NF\n,TRL.DT_RECEBIMENTO                                       AS DT_RECEB\n,TRL.DT_VENCIMENTO\n,TRL.DT_PAGAMENTO_PREVISTO\n,CASE\n   WHEN A.NR_SEQ_PROTOCOLO IS NOT NULL OR NF.NR_NOTA_FISCAL IS NOT NULL THEN 'FATURADO'\n   ELSE 'ABERTO'\n END                                                         STATUS_FATURAMENTO\n,A.QT_ITEM\n,A.VL_ITEM\n,NVL(TRUNC(TRL.DT_RECEBIMENTO,'DD')\n    ,TRUNC(SYSDATE,'DD') )\n        - TRUNC(TRL.DT_PAGAMENTO_PREVISTO,'DD')            AS TEMPO_RECEB\n    \n,NVL(TRUNC(PC.DT_PERIODO_INICIAL,'DD')\n    ,TRUNC(SYSDATE,'DD') ) \n        - TRUNC(A.DT_ENTRADA,'DD')                        AS TEMPO_FATURAMENTO\n\n,EST.NM_FANTASIA_ESTAB\nFROM TB A\nINNER JOIN CONVENIO                 CONV         ON CONV.CD_CONVENIO = A.CD_CONVENIO_PARAMETRO\nINNER JOIN ESTABELECIMENTO          EST          ON EST.CD_ESTABELECIMENTO = A.CD_ESTABELECIMENTO\nINNER JOIN SETOR_ATENDIMENTO        SA           ON SA.CD_SETOR_ATENDIMENTO = A.CD_SETOR_ATENDIMENTO\nINNER JOIN CONTA_PACIENTE_ESTRUTURA CPE          ON CAST(CPE.CD_ESTRUTURA AS VARCHAR(5)) = A.IE_EMITE_CONTA\nLEFT JOIN PROTOCOLO_CONVENIO        PC           ON PC.NR_SEQ_PROTOCOLO = A.NR_SEQ_PROTOCOLO\nLEFT JOIN NOTA_FISCAL               NF           ON NF.NR_INTERNO_CONTA = A.NR_INTERNO_CONTA\n\n\n\nOUTER APPLY(\n    SELECT\n        TR.NR_TITULO\n        ,TRL.DT_RECEBIMENTO\n        ,TR.DT_VENCIMENTO\n        ,TR.DT_PAGAMENTO_PREVISTO\n    FROM TITULO_RECEBER TR\n    LEFT JOIN TITULO_RECEBER_LIQ TRL ON TR.NR_TITULO = TRL.NR_TITULO\n    WHERE TR.NR_SEQ_PROTOCOLO = A.NR_SEQ_PROTOCOLO\n        AND ROWNUM = 1\n)TRL\n\nOUTER APPLY(\n    SELECT\n    TMP.*\nFROM(\n    SELECT\n        AC.NR_SEQUENCIA\n        ,AC.NR_ATENDIMENTO\n        ,AC.CD_SENHA\n    FROM AUTORIZACAO_CONVENIO AC\n    WHERE AC.NR_ATENDIMENTO = A.NR_ATENDIMENTO\n    ORDER BY AC.NR_SEQUENCIA DESC\n)TMP\nWHERE ROWNUM = 1\n) SENHA\n\nOUTER APPLY(\n    SELECT\n        TMP.*\n    FROM(\n        SELECT \n            ACC.CD_USUARIO_CONVENIO\n        FROM ATEND_CATEGORIA_CONVENIO ACC\n        WHERE ACC.NR_ATENDIMENTO = A.NR_ATENDIMENTO\n        ORDER BY ACC.NR_SEQ_INTERNO DESC\n        )TMP\n    WHERE ROWNUM = 1\n) ACC\n",
						"partitionOption": "None",
						"queryTimeout": "02:00:00"
					},
					"sink": {
						"type": "AzureSqlSink",
						"preCopyScript": "TRUNCATE TABLE stg.dev_ciclo_tasy",
						"tableOption": "autoCreate",
						"disableMetricsCollection": false
					},
					"enableStaging": false,
					"translator": {
						"type": "TabularTranslator",
						"mappings": [
							{
								"source": {
									"name": "CD_PESSOA_FISICA",
									"type": "String"
								},
								"sink": {
									"name": "CD_PESSOA_FISICA",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "NR_ATENDIMENTO",
									"type": "Decimal"
								},
								"sink": {
									"name": "NR_ATENDIMENTO",
									"type": "Decimal",
									"physicalType": "decimal",
									"scale": 0,
									"precision": 10
								}
							},
							{
								"source": {
									"name": "NR_INTERNO_CONTA",
									"type": "Decimal"
								},
								"sink": {
									"name": "NR_INTERNO_CONTA",
									"type": "Decimal",
									"physicalType": "decimal",
									"scale": 0,
									"precision": 10
								}
							},
							{
								"source": {
									"name": "CD_CARTERINHA_PAC",
									"type": "String"
								},
								"sink": {
									"name": "CD_CARTERINHA_PAC",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "NR_GUIA",
									"type": "String"
								},
								"sink": {
									"name": "NR_GUIA",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "SENHA_CONV",
									"type": "String"
								},
								"sink": {
									"name": "SENHA_CONV",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "CGC_CONVENIO",
									"type": "String"
								},
								"sink": {
									"name": "CGC_CONVENIO",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "CD_CONVENIO",
									"type": "Decimal"
								},
								"sink": {
									"name": "CD_CONVENIO",
									"type": "Decimal",
									"physicalType": "decimal",
									"scale": 0,
									"precision": 5
								}
							},
							{
								"source": {
									"name": "DS_CONVENIO",
									"type": "String"
								},
								"sink": {
									"name": "DS_CONVENIO",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "DT_ENTRADA",
									"type": "DateTime"
								},
								"sink": {
									"name": "DT_ENTRADA",
									"type": "DateTime",
									"physicalType": "datetime2"
								}
							},
							{
								"source": {
									"name": "CD_ESTABELECIMENTO",
									"type": "Decimal"
								},
								"sink": {
									"name": "CD_ESTABELECIMENTO",
									"type": "Decimal",
									"physicalType": "decimal",
									"scale": 0,
									"precision": 4
								}
							},
							{
								"source": {
									"name": "DS_SETOR_ATENDIMENTO",
									"type": "String"
								},
								"sink": {
									"name": "DS_SETOR_ATENDIMENTO",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "DT_LANC_ITEM",
									"type": "DateTime"
								},
								"sink": {
									"name": "DT_LANC_ITEM",
									"type": "DateTime",
									"physicalType": "datetime2"
								}
							},
							{
								"source": {
									"name": "CLASSIF_ITEM",
									"type": "String"
								},
								"sink": {
									"name": "CLASSIF_ITEM",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "NR_SEQUENCIA",
									"type": "Decimal"
								},
								"sink": {
									"name": "NR_SEQUENCIA",
									"type": "Decimal",
									"physicalType": "decimal",
									"scale": 0,
									"precision": 10
								}
							},
							{
								"source": {
									"name": "CD_ITEM",
									"type": "Double"
								},
								"sink": {
									"name": "CD_ITEM",
									"type": "Double",
									"physicalType": "float"
								}
							},
							{
								"source": {
									"name": "DS_ITEM",
									"type": "String"
								},
								"sink": {
									"name": "DS_ITEM",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "DT_INICIO_PRE_FAT",
									"type": "DateTime"
								},
								"sink": {
									"name": "DT_INICIO_PRE_FAT",
									"type": "DateTime",
									"physicalType": "datetime2"
								}
							},
							{
								"source": {
									"name": "DT_ENVIO",
									"type": "DateTime"
								},
								"sink": {
									"name": "DT_ENVIO",
									"type": "DateTime",
									"physicalType": "datetime2"
								}
							},
							{
								"source": {
									"name": "DT_EMISSAO_NF",
									"type": "DateTime"
								},
								"sink": {
									"name": "DT_EMISSAO_NF",
									"type": "DateTime",
									"physicalType": "datetime2"
								}
							},
							{
								"source": {
									"name": "DT_RECEB",
									"type": "DateTime"
								},
								"sink": {
									"name": "DT_RECEB",
									"type": "DateTime",
									"physicalType": "datetime2"
								}
							},
							{
								"source": {
									"name": "DT_VENCIMENTO",
									"type": "DateTime"
								},
								"sink": {
									"name": "DT_VENCIMENTO",
									"type": "DateTime",
									"physicalType": "datetime2"
								}
							},
							{
								"source": {
									"name": "DT_PAGAMENTO_PREVISTO",
									"type": "DateTime"
								},
								"sink": {
									"name": "DT_PAGAMENTO_PREVISTO",
									"type": "DateTime",
									"physicalType": "datetime2"
								}
							},
							{
								"source": {
									"name": "STATUS_FATURAMENTO",
									"type": "String"
								},
								"sink": {
									"name": "STATUS_FATURAMENTO",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "QT_ITEM",
									"type": "Decimal"
								},
								"sink": {
									"name": "QT_ITEM",
									"type": "Decimal",
									"physicalType": "decimal",
									"scale": 3,
									"precision": 9
								}
							},
							{
								"source": {
									"name": "VL_ITEM",
									"type": "Double"
								},
								"sink": {
									"name": "VL_ITEM",
									"type": "Double",
									"physicalType": "float"
								}
							},
							{
								"source": {
									"name": "TEMPO_RECEB",
									"type": "Double"
								},
								"sink": {
									"name": "TEMPO_RECEB",
									"type": "Double",
									"physicalType": "float"
								}
							},
							{
								"source": {
									"name": "TEMPO_FATURAMENTO",
									"type": "Double"
								},
								"sink": {
									"name": "TEMPO_FATURAMENTO",
									"type": "Double",
									"physicalType": "float"
								}
							},
							{
								"source": {
									"name": "NM_FANTASIA_ESTAB",
									"type": "String"
								},
								"sink": {
									"name": "NM_FANTASIA_ESTAB",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "NR_TITULO",
									"type": "Double"
								},
								"sink": {
									"name": "NR_TITULO",
									"type": "Decimal",
									"physicalType": "decimal",
									"scale": 0,
									"precision": 18
								}
							}
						],
						"typeConversion": true,
						"typeConversionSettings": {
							"allowDataTruncation": true,
							"treatBooleanAsNumber": false
						}
					}
				},
				"inputs": [
					{
						"referenceName": "Tasy_Ciclo",
						"type": "DatasetReference"
					}
				],
				"outputs": [
					{
						"referenceName": "AZ_TB_CICLO",
						"type": "DatasetReference"
					}
				]
			}
		],
		"folder": {
			"name": "Ciclo Receita"
		},
		"annotations": []
	}
}