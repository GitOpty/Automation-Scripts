{
	"name": "Dado Prod",
	"properties": {
		"activities": [
			{
				"name": "PROD TASY HTML",
				"type": "Copy",
				"dependsOn": [],
				"policy": {
					"timeout": "7.00:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "OracleSource",
						"oracleReaderQuery": "WITH MEDICO_ESP AS(\nSELECT\n    TMP.CD_PESSOA_FISICA\n    ,TMP.CD_ESPECIALIDADE\n    ,TMP.DS_ESPECIALIDADE\n    ,TMP.NM_MEDICO\nFROM(\nSELECT \n    A.CD_PESSOA_FISICA\n    ,M.NM_GUERRA        AS NM_MEDICO\n    ,A.CD_ESPECIALIDADE\n    ,E.DS_ESPECIALIDADE\n    ,ROW_NUMBER() OVER (PARTITION BY A.CD_PESSOA_FISICA ORDER BY A.NR_SEQ_PRIORIDADE ASC) ID_LINHA\nFROM MEDICO_ESPECIALIDADE A\nINNER JOIN ESPECIALIDADE_MEDICA E ON E.CD_ESPECIALIDADE = A.CD_ESPECIALIDADE\nINNER JOIN MEDICO M ON M.CD_PESSOA_FISICA = A.CD_PESSOA_FISICA\n)TMP\nWHERE TMP.ID_LINHA = 1\n)\n\nSELECT \nEMP.DS_NOME_CURTO           AS MARCA\n--,EST.CD_ESTABELECIMENTO     AS CD_ESTABELECIMENTO\n,est.nm_fantasia_estab      AS NM_ESTABELECIMENTO\n,tp.ds_tipo_atendimento\n--,CPR.CD_SETOR_ATENDIMENTO\n,SA.DS_SETOR_ATENDIMENTO    AS DS_SETOR_ATENDIMENTO\n,conv.ds_convenio           AS DS_CONVENIO_FAT\n,AP.CD_PESSOA_FISICA\n,AP.NR_ATENDIMENTO\n,CPR.NR_INTERNO_CONTA\n,AP.DT_ENTRADA\n,AP.DT_ALTA\n,AP.CD_MEDICO_ATENDIMENTO\n,MES.NM_MEDICO              AS MEDICO_ATENDIMENTO\n,MES.DS_ESPECIALIDADE       AS ESPECIALIDADE_MEDICO_ATEND\n,CASE\n    WHEN CPR.NR_PRESCRICAO = NULL THEN 'N'\n        ELSE 'S'\n    END IE_PRESCRICAO    \n,CPR.CD_MATERIAL\n,mat.ds_reduzida            AS DS_MATERIAL\n,CPR.CD_PROCEDIMENTO\n,PRO.DS_PROCEDIMENTO        AS DS_PROCEDIMENTO\n,CPR.QT_RESUMO              AS QTD\n,CPR.VL_PROCEDIMENTO\n,CPR.VL_MATERIAL\n,CPR.IE_DIARIA\n,NVL(CP.DT_CONTA_PROTOCOLO,NF.DT_EMISSAO) AS DT_FATURAMENTO\n,CASE\n   WHEN CP.NR_SEQ_PROTOCOLO IS NOT NULL OR NF.NR_NOTA_FISCAL IS NOT NULL  THEN 'FATURADO'\n   ELSE 'ABERTO'\n END                                                         STATUS_FATURAMENTO\n,AP.NM_USUARIO_ATEND AS NM_USUARIO_RECEPCAO\n,NVL(NF.NM_USUARIO,PC.NM_USUARIO) AS USUARIO_FATURAMENTO\n--,CPR.*\nFROM CONTA_PACIENTE_RESUMO CPR\nINNER JOIN CONTA_PACIENTE CP                        ON CP.NR_INTERNO_CONTA = CPR.NR_INTERNO_CONTA\nINNER JOIN ATENDIMENTO_PACIENTE AP                  ON AP.NR_ATENDIMENTO = CP.NR_ATENDIMENTO\nINNER JOIN ESTABELECIMENTO EST                      ON EST.CD_ESTABELECIMENTO = AP.CD_ESTABELECIMENTO\nINNER JOIN EMPRESA EMP                              ON EMP.CD_EMPRESA = EST.CD_EMPRESA\nINNER JOIN TIPO_ATENDIMENTO_V   TP                  ON TP.CD_TIPO_ATENDIMENTO = AP.IE_TIPO_ATENDIMENTO\nINNER JOIN SETOR_ATENDIMENTO   SA                   ON TRIM(cpr.cd_setor_atendimento) = SA.CD_SETOR_ATENDIMENTO\nINNER JOIN CONVENIO            CONV                 ON CONV.CD_CONVENIO = cp.cd_convenio_parametro\nLEFT JOIN MATERIAL  MAT                             ON MAT.CD_MATERIAL = CPR.CD_MATERIAL\nLEFT JOIN MEDICO_ESP            MES                 ON MES.CD_PESSOA_FISICA = AP.CD_MEDICO_ATENDIMENTO\nLEFT JOIN PROTOCOLO_CONVENIO    PC                  ON PC.NR_SEQ_PROTOCOLO = CP.NR_SEQ_PROTOCOLO\n--LEFT JOIN CIRURGIA  CIR                             ON CIR.NR_CIRURGIA = CPR.NR_CIRURGIA  \nOUTER APPLY(\n    SELECT\n        P.DS_PROCEDIMENTO\n    FROM PROCEDIMENTO P\n    WHERE P.CD_PROCEDIMENTO = CPR.CD_PROCEDIMENTO\n        AND ROWNUM = 1    \n)PRO\nOUTER APPLY(\n    SELECT\n            Z.NR_NOTA_FISCAL\n            ,Z.NR_INTERNO_CONTA\n            ,Z.NM_USUARIO\n            ,MAX(Z.DT_EMISSAO) DT_EMISSAO\n            ,MAX(Z.NR_SEQUENCIA) NR_SEQ\n    FROM NOTA_FISCAL Z\n    WHERE Z.nr_interno_conta = CP.NR_INTERNO_CONTA\n    GROUP BY \n            Z.NR_NOTA_FISCAL\n            ,Z.NR_INTERNO_CONTA\n            ,Z.NM_USUARIO\n            ,Z.DT_EMISSAO\n)NF\n\nWHERE AP.DT_CANCELAMENTO IS NULL\n    AND CP.IE_CANCELAMENTO IS NULL\n    AND TO_CHAR(TRUNC(AP.DT_ENTRADA,'MM'),'YYYY-MM-DD') BETWEEN '2020-01-01' AND '2021-12-01' \n    --AND AP.NR_ATENDIMENTO = 540792\n    AND CPR.QT_EXCLUSAO_CONTA = 0\n",
						"partitionOption": "None",
						"queryTimeout": "02:00:00"
					},
					"sink": {
						"type": "AzureSqlSink",
						"writeBehavior": "insert",
						"sqlWriterUseTableLock": false,
						"tableOption": "autoCreate",
						"disableMetricsCollection": false
					},
					"enableStaging": false
				},
				"inputs": [
					{
						"referenceName": "Tasy_Ciclo",
						"type": "DatasetReference"
					}
				],
				"outputs": [
					{
						"referenceName": "AZ_PROD_AM",
						"type": "DatasetReference"
					}
				]
			}
		],
		"folder": {
			"name": "A&M"
		},
		"annotations": []
	}
}